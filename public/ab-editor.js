!function(){"use strict";const e=new URLSearchParams(window.location.search);if(!e.has("__navlens_editor"))return;const n=e.get("__navlens_editor"),t=e.get("__variant"),a=e.get("__ts"),i=e.get("__token"),o=e.get("__sig"),l=document.querySelector("script[data-site-id]"),s=l?.dataset.siteId,r=l?.dataset.apiHost||l?.src.replace(/\/tracker\.js.*/,"");if(!s||!r)return void console.error("[navlens-editor] Missing site ID or API host");const d=r.includes("://")?r:`https://${r}`;(async function(){if(!o||!a||!i)return alert("Invalid editor link. Please generate a new link from the dashboard."),console.error("[navlens-editor] Missing signature, timestamp, or token"),!1;const e=parseInt(a,10),l=Date.now()-e;if(l>36e5||l<0)return alert("Editor link has expired. Please generate a new link from the dashboard."),console.error("[navlens-editor] Editor URL expired"),!1;try{const e=await fetch(`${d}/api/experiments/verify-editor`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({experimentId:n,variantId:t,timestamp:a,token:i,signature:o})}),l=await e.json();return l.valid?(console.log("[navlens-editor] Signature verified successfully"),!0):(alert(`Editor access denied: ${l.error||"Invalid signature"}. Please generate a new link.`),console.error("[navlens-editor] Signature verification failed:",l.error),!1)}catch(e){return console.error("[navlens-editor] Verification request failed:",e),alert("Could not verify editor access. Please check your connection and try again."),!1}})().then(e=>{if(!e)return;let i=null,l=[],d=!1;const c=document.createElement("style");c.id="navlens-editor-styles",c.textContent="\n    .nv-editor-overlay {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      min-height: 100%;\n      pointer-events: none;\n      z-index: 999999;\n    }\n    \n    .nv-highlight {\n      position: absolute;\n      pointer-events: none;\n      border: 2px dashed #3b82f6;\n      background: rgba(59, 130, 246, 0.1);\n      transition: all 0.1s ease;\n      z-index: 999998;\n    }\n    \n    .nv-selected {\n      border: 2px solid #10b981 !important;\n      background: rgba(16, 185, 129, 0.1) !important;\n    }\n    \n    .nv-toolbar {\n      position: fixed;\n      top: 10px;\n      right: 10px;\n      background: #1f2937;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      font-size: 14px;\n      z-index: 1000000;\n      pointer-events: auto;\n      box-shadow: 0 10px 25px rgba(0,0,0,0.3);\n      min-width: 320px;\n      max-width: 380px;\n      max-height: 90vh;\n      overflow-y: auto;\n    }\n    \n    .nv-toolbar-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      margin-bottom: 12px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid #374151;\n    }\n    \n    .nv-toolbar-title {\n      font-weight: 600;\n      color: #10b981;\n    }\n    \n    .nv-btn {\n      padding: 6px 12px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 500;\n      transition: all 0.2s;\n    }\n    \n    .nv-btn-primary {\n      background: #3b82f6;\n      color: white;\n    }\n    \n    .nv-btn-primary:hover {\n      background: #2563eb;\n    }\n    \n    .nv-btn-success {\n      background: #10b981;\n      color: white;\n    }\n    \n    .nv-btn-danger {\n      background: #ef4444;\n      color: white;\n    }\n    \n    .nv-btn-secondary {\n      background: #374151;\n      color: white;\n    }\n    \n    .nv-panel {\n      margin-top: 12px;\n    }\n    \n    .nv-panel-section {\n      margin-bottom: 12px;\n    }\n    \n    .nv-panel-label {\n      font-size: 11px;\n      color: #9ca3af;\n      margin-bottom: 4px;\n      text-transform: uppercase;\n    }\n    \n    .nv-input {\n      width: 100%;\n      padding: 8px;\n      border: 1px solid #374151;\n      border-radius: 4px;\n      background: #111827;\n      color: white;\n      font-size: 13px;\n      box-sizing: border-box;\n    }\n    \n    .nv-input:focus {\n      outline: none;\n      border-color: #3b82f6;\n    }\n    \n    .nv-color-row {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n    }\n    \n    .nv-color-input {\n      width: 40px;\n      height: 32px;\n      border: none;\n      cursor: pointer;\n      border-radius: 4px;\n    }\n    \n    .nv-selector-display {\n      font-family: monospace;\n      font-size: 11px;\n      color: #6b7280;\n      margin-top: 4px;\n      word-break: break-all;\n    }\n    \n    .nv-mod-list {\n      max-height: 150px;\n      overflow-y: auto;\n      margin-top: 8px;\n    }\n    \n    .nv-mod-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 6px 8px;\n      background: #111827;\n      border-radius: 4px;\n      margin-bottom: 4px;\n      font-size: 12px;\n    }\n    \n    .nv-mod-delete {\n      color: #ef4444;\n      cursor: pointer;\n      padding: 2px 6px;\n    }\n\n    .nv-row {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n    }\n\n    .nv-file-input {\n      display: none;\n    }\n\n    .nv-file-btn {\n      display: inline-flex;\n      align-items: center;\n      gap: 4px;\n      padding: 6px 10px;\n      background: #374151;\n      color: white;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n    }\n\n    .nv-file-btn:hover {\n      background: #4b5563;\n    }\n\n    .nv-preview-img {\n      max-width: 100%;\n      max-height: 80px;\n      border-radius: 4px;\n      margin-top: 8px;\n    }\n\n    .nv-type-group {\n      padding: 4px 0;\n      border-bottom: 1px solid #374151;\n    }\n\n    .nv-type-group:last-child {\n      border-bottom: none;\n    }\n\n    .nv-type-group-label {\n      font-size: 10px;\n      color: #6b7280;\n      padding: 4px 8px;\n      text-transform: uppercase;\n    }\n\n    .nv-checkbox-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 4px 0;\n    }\n\n    .nv-checkbox-row input[type=\"checkbox\"] {\n      width: 16px;\n      height: 16px;\n    }\n\n    .nv-two-col {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 8px;\n    }\n\n    .nv-tabs {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 8px;\n    }\n\n    .nv-tab {\n      padding: 4px 8px;\n      font-size: 11px;\n      background: #374151;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .nv-tab.active {\n      background: #3b82f6;\n    }\n  ",document.head.appendChild(c);const p=document.createElement("div");p.className="nv-editor-overlay",p.id="navlens-editor";const v=document.createElement("div");v.className="nv-highlight",v.style.display="none",p.appendChild(v);const m=document.createElement("div");m.className="nv-toolbar",m.innerHTML='\n    <div class="nv-toolbar-header">\n      <span class="nv-toolbar-title">üß™ Navlens Editor</span>\n      <div style="display: flex; gap: 4px;">\n        <button class="nv-btn" id="nv-minimize" title="Minimize to floating button">‚ûñ</button>\n        <button class="nv-btn nv-btn-danger" id="nv-close">‚úï</button>\n      </div>\n    </div>\n    \n    \x3c!-- Mode & Viewport Controls --\x3e\n    <div style="display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap;">\n      <div style="flex: 1; min-width: 160px;">\n        <div class="nv-panel-label" style="margin-bottom: 4px;">Mode</div>\n        <div style="display: flex; background: #374151; border-radius: 6px; overflow: hidden;">\n          <button id="nv-mode-edit" class="nv-mode-btn nv-mode-active" style="flex:1; padding: 6px 6px; font-size: 10px; border: none; cursor: pointer; background: #3b82f6; color: white;">üñ±Ô∏è Edit</button>\n          <button id="nv-mode-drag" class="nv-mode-btn" style="flex:1; padding: 6px 6px; font-size: 10px; border: none; cursor: pointer; background: transparent; color: #9ca3af;">‚úã Drag</button>\n          <button id="nv-mode-navigate" class="nv-mode-btn" style="flex:1; padding: 6px 6px; font-size: 10px; border: none; cursor: pointer; background: transparent; color: #9ca3af;">üîó Nav</button>\n        </div>\n      </div>\n    </div>\n    \n    \x3c!-- Undo/Redo Row --\x3e\n    <div style="display: flex; gap: 8px; margin-bottom: 10px;">\n      <button id="nv-undo" class="nv-btn" style="flex:1;" disabled title="Undo (Ctrl+Z)">‚Ü©Ô∏è Undo</button>\n      <button id="nv-redo" class="nv-btn" style="flex:1;" disabled title="Redo (Ctrl+Shift+Z)">‚Ü™Ô∏è Redo</button>\n    </div>\n    \n    <div id="nv-instructions" style="color: #9ca3af; font-size: 12px;">\n      Click on any element to select it\n    </div>\n    \n    <div id="nv-edit-panel" class="nv-panel" style="display: none;">\n      <div class="nv-panel-section">\n        <div class="nv-panel-label">Selected Element</div>\n        <div id="nv-selected-tag" style="font-weight: 600;"></div>\n        <div id="nv-selected-selector" class="nv-selector-display"></div>\n      </div>\n      \n      <div class="nv-panel-section">\n        <div class="nv-panel-label">Modification Type</div>\n        <select id="nv-mod-type" class="nv-input">\n          \x3c!-- Options populated dynamically based on selected element --\x3e\n        </select>\n        <div id="nv-type-hint" style="font-size: 10px; color: #6b7280; margin-top: 4px;"></div>\n      </div>\n      \n      \x3c!-- CSS Panel --\x3e\n      <div id="nv-css-panel" class="nv-panel-section">\n        <div class="nv-panel-label">Background Color</div>\n        <div class="nv-color-row">\n          <input type="color" id="nv-bg-color" class="nv-color-input" value="#ffffff">\n          <input type="text" id="nv-bg-color-text" class="nv-input" placeholder="#ffffff" style="flex:1;">\n        </div>\n        \n        <div class="nv-panel-label" style="margin-top: 8px;">Text Color</div>\n        <div class="nv-color-row">\n          <input type="color" id="nv-text-color" class="nv-color-input" value="#000000">\n          <input type="text" id="nv-text-color-text" class="nv-input" placeholder="#000000" style="flex:1;">\n        </div>\n        \n        <div class="nv-panel-label" style="margin-top: 8px;">Font Size</div>\n        <input type="text" id="nv-font-size" class="nv-input" placeholder="e.g., 16px">\n      </div>\n      \n      \x3c!-- Text Panel --\x3e\n      <div id="nv-text-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New Text</div>\n        <textarea id="nv-new-text" class="nv-input" rows="3" placeholder="Enter replacement text..."></textarea>\n      </div>\n\n      \x3c!-- Hide Panel --\x3e\n      <div id="nv-hide-panel" class="nv-panel-section" style="display: none;">\n        <div style="color: #fbbf24; font-size: 12px;">\n          ‚ö†Ô∏è This will hide the selected element (CSS display: none). Element stays in DOM.\n        </div>\n      </div>\n\n      \x3c!-- Remove Panel (Hard Delete) --\x3e\n      <div id="nv-remove-panel" class="nv-panel-section" style="display: none;">\n        <div style="color: #ef4444; font-size: 12px;">\n          üóëÔ∏è This will <strong>permanently remove</strong> the element from the DOM for this variant.\n        </div>\n      </div>\n\n      \x3c!-- Clone Panel --\x3e\n      <div id="nv-clone-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Number of Clones</div>\n        <input type="number" id="nv-clone-count" class="nv-input" min="1" max="10" value="1" placeholder="1-10">\n        <div class="nv-panel-label" style="margin-top: 8px;">Position</div>\n        <select id="nv-clone-position" class="nv-input">\n          <option value="after">After Original</option>\n          <option value="before">Before Original</option>\n        </select>\n      </div>\n\n      \x3c!-- Image Panel --\x3e\n      <div id="nv-image-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Image URL</div>\n        <input type="text" id="nv-image-url" class="nv-input" placeholder="https://example.com/image.jpg">\n        <div style="margin: 8px 0; text-align: center; color: #6b7280; font-size: 11px;">‚Äî OR ‚Äî</div>\n        <label class="nv-file-btn">\n          üìÅ Upload Image\n          <input type="file" id="nv-image-file" class="nv-file-input" accept="image/*">\n        </label>\n        <div id="nv-image-preview"></div>\n      </div>\n\n      \x3c!-- Link Panel --\x3e\n      <div id="nv-link-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Link URL</div>\n        <input type="text" id="nv-link-url" class="nv-input" placeholder="https://example.com/page">\n        <div class="nv-panel-label" style="margin-top: 8px;">Open In</div>\n        <select id="nv-link-target" class="nv-input">\n          <option value="_self">Same Tab</option>\n          <option value="_blank">New Tab</option>\n        </select>\n      </div>\n\n      \x3c!-- Insert HTML Panel --\x3e\n      <div id="nv-insertHtml-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Position</div>\n        <select id="nv-insert-position" class="nv-input">\n          <option value="before">Before Element</option>\n          <option value="after">After Element</option>\n          <option value="prepend">Inside (Start)</option>\n          <option value="append">Inside (End)</option>\n        </select>\n        <div class="nv-panel-label" style="margin-top: 8px;">HTML Code</div>\n        <textarea id="nv-insert-html" class="nv-input" rows="4" placeholder="<div>Your HTML here</div>" style="font-family: monospace;"></textarea>\n      </div>\n\n      \x3c!-- Replace HTML Panel --\x3e\n      <div id="nv-replaceHtml-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New HTML</div>\n        <textarea id="nv-replace-html" class="nv-input" rows="4" placeholder="<div>Replacement HTML</div>" style="font-family: monospace;"></textarea>\n        <div style="color: #fbbf24; font-size: 11px; margin-top: 4px;">\n          ‚ö†Ô∏è This replaces the entire element with your HTML.\n        </div>\n      </div>\n\n      \x3c!-- Resize Panel --\x3e\n      <div id="nv-resize-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-two-col">\n          <div>\n            <div class="nv-panel-label">Width</div>\n            <input type="text" id="nv-resize-width" class="nv-input" placeholder="e.g., 200px or 50%">\n          </div>\n          <div>\n            <div class="nv-panel-label">Height</div>\n            <input type="text" id="nv-resize-height" class="nv-input" placeholder="e.g., 100px or auto">\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Clone Panel --\x3e\n      <div id="nv-clone-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Number of Copies</div>\n        <input type="number" id="nv-clone-count" class="nv-input" value="1" min="1" max="10">\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Copies will be inserted after the original element.\n        </div>\n      </div>\n\n      \x3c!-- Reorder Panel --\x3e\n      <div id="nv-reorder-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Move to Position</div>\n        <input type="number" id="nv-reorder-index" class="nv-input" value="0" min="0">\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Position among siblings (0 = first).\n        </div>\n      </div>\n\n      \x3c!-- Move Panel --\x3e\n      <div id="nv-move-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-two-col">\n          <div>\n            <div class="nv-panel-label">X Offset (px)</div>\n            <input type="number" id="nv-move-x" class="nv-input" value="0">\n          </div>\n          <div>\n            <div class="nv-panel-label">Y Offset (px)</div>\n            <input type="number" id="nv-move-y" class="nv-input" value="0">\n          </div>\n        </div>\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Uses CSS transform to offset the element.\n        </div>\n      </div>\n\n      \x3c!-- Attribute Panel --\x3e\n      <div id="nv-attribute-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Attribute Name</div>\n        <input type="text" id="nv-attr-name" class="nv-input" placeholder="e.g., data-custom, title, aria-label">\n        <div class="nv-panel-label" style="margin-top: 8px;">Attribute Value</div>\n        <input type="text" id="nv-attr-value" class="nv-input" placeholder="Value to set">\n      </div>\n\n      \x3c!-- Class Panel --\x3e\n      <div id="nv-class-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Add Classes</div>\n        <input type="text" id="nv-class-add" class="nv-input" placeholder="class1, class2">\n        <div class="nv-panel-label" style="margin-top: 8px;">Remove Classes</div>\n        <input type="text" id="nv-class-remove" class="nv-input" placeholder="class1, class2">\n        <div id="nv-current-classes" style="font-size: 11px; color: #6b7280; margin-top: 4px;"></div>\n      </div>\n\n      \x3c!-- Click Redirect Panel --\x3e\n      <div id="nv-clickRedirect-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Redirect URL</div>\n        <input type="text" id="nv-redirect-url" class="nv-input" placeholder="https://example.com/page">\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Clicking this element will navigate to the URL.\n        </div>\n      </div>\n\n      \x3c!-- Tooltip Panel --\x3e\n      <div id="nv-tooltip-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Tooltip Text</div>\n        <textarea id="nv-tooltip-text" class="nv-input" rows="2" placeholder="Hover text..."></textarea>\n        <div class="nv-panel-label" style="margin-top: 8px;">Position</div>\n        <select id="nv-tooltip-position" class="nv-input">\n          <option value="top">Top</option>\n          <option value="bottom">Bottom</option>\n          <option value="left">Left</option>\n          <option value="right">Right</option>\n        </select>\n      </div>\n\n      \x3c!-- Sticky Panel --\x3e\n      <div id="nv-sticky-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Stick to Top</div>\n        <input type="text" id="nv-sticky-top" class="nv-input" placeholder="e.g., 0px or 20px" value="0px">\n        <div class="nv-panel-label" style="margin-top: 8px;">Z-Index</div>\n        <input type="number" id="nv-sticky-zindex" class="nv-input" value="1000" min="1" max="9999999">\n      </div>\n\n      \x3c!-- Placeholder Panel --\x3e\n      <div id="nv-placeholder-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New Placeholder Text</div>\n        <input type="text" id="nv-placeholder-text" class="nv-input" placeholder="Enter new placeholder...">\n      </div>\n\n      \x3c!-- Form Action Panel --\x3e\n      <div id="nv-formAction-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New Form Action URL</div>\n        <input type="text" id="nv-form-action-url" class="nv-input" placeholder="https://example.com/submit">\n        <div style="color: #fbbf24; font-size: 11px; margin-top: 4px;">\n          ‚ö†Ô∏è Only applies to form elements.\n        </div>\n      </div>\n\n      \x3c!-- Animation Panel --\x3e\n      <div id="nv-animation-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Animation Name</div>\n        <select id="nv-animation-name" class="nv-input">\n          <option value="">Select animation...</option>\n          <option value="fadeIn">Fade In</option>\n          <option value="fadeOut">Fade Out</option>\n          <option value="slideInLeft">Slide In Left</option>\n          <option value="slideInRight">Slide In Right</option>\n          <option value="slideInUp">Slide In Up</option>\n          <option value="slideInDown">Slide In Down</option>\n          <option value="bounce">Bounce</option>\n          <option value="pulse">Pulse</option>\n          <option value="shake">Shake</option>\n          <option value="custom">Custom CSS</option>\n        </select>\n        <div class="nv-two-col" style="margin-top: 8px;">\n          <div>\n            <div class="nv-panel-label">Duration</div>\n            <input type="text" id="nv-animation-duration" class="nv-input" placeholder="0.5s" value="0.5s">\n          </div>\n          <div>\n            <div class="nv-panel-label">Repeat</div>\n            <select id="nv-animation-iteration" class="nv-input">\n              <option value="1">Once</option>\n              <option value="2">2 times</option>\n              <option value="3">3 times</option>\n              <option value="5">5 times</option>\n              <option value="infinite">‚àû Infinite</option>\n            </select>\n          </div>\n        </div>\n        <div class="nv-panel-label" style="margin-top: 8px;">Delay (before start)</div>\n        <input type="text" id="nv-animation-delay" class="nv-input" placeholder="0s" value="0s">\n        <div id="nv-animation-custom-container" style="display: none; margin-top: 8px;">\n          <div class="nv-panel-label">Custom CSS Animation</div>\n          <textarea id="nv-animation-custom" class="nv-input" rows="2" placeholder="transform: scale(1.1);" style="font-family: monospace;"></textarea>\n        </div>\n      </div>\n      \n      <div style="display: flex; gap: 8px; margin-top: 12px;">\n        <button class="nv-btn nv-btn-primary" id="nv-add-mod" style="flex: 1;">Add Change</button>\n        <button class="nv-btn nv-btn-secondary" id="nv-cancel">Cancel</button>\n      </div>\n    </div>\n    \n    <div class="nv-panel-section" style="margin-top: 16px; padding-top: 12px; border-top: 1px solid #374151;">\n      <div class="nv-panel-label">Saved Changes (<span id="nv-mod-count">0</span>)</div>\n      <div id="nv-mod-list" class="nv-mod-list"></div>\n      <button class="nv-btn nv-btn-success" id="nv-save" style="width: 100%; margin-top: 8px;">\n        üíæ Save All Changes\n      </button>\n    </div>\n  ',p.appendChild(m),document.body.appendChild(p);const u=new Map,g={css:{label:"üé® Change Style (CSS)",hint:"Modify colors, fonts, spacing",universal:!0},text:{label:"‚úèÔ∏è Change Text",hint:"Replace text content",universal:!0},hide:{label:"üëÅÔ∏è Hide Element",hint:"Hide from visitors (CSS)",universal:!0},remove:{label:"üóëÔ∏è Remove Element",hint:"Delete from DOM",universal:!0},clone:{label:"üìã Clone Element",hint:"Duplicate this element",universal:!0},insertHtml:{label:"‚ûï Insert HTML",hint:"Add HTML before/after",universal:!0},replaceHtml:{label:"üîÑ Replace HTML",hint:"Replace with custom HTML",universal:!0},resize:{label:"üìê Resize Element",hint:"Change width/height",universal:!0},reorder:{label:"‚ÜïÔ∏è Reorder Element",hint:"Move among siblings",universal:!0},move:{label:"‚úã Move Element",hint:"Offset position",universal:!0},attribute:{label:"‚öôÔ∏è Modify Attribute",hint:"Change any attribute",universal:!0},class:{label:"üè∑Ô∏è Toggle Classes",hint:"Add/remove CSS classes",universal:!0},tooltip:{label:"üí¨ Add Tooltip",hint:"Show text on hover",universal:!0},sticky:{label:"üìå Make Sticky",hint:"Stick to viewport",universal:!0},animation:{label:"‚ú® Add Animation",hint:"Animate on load",universal:!0},clickRedirect:{label:"üñ±Ô∏è Click Redirect",hint:"Navigate on click",universal:!0},image:{label:"üñºÔ∏è Replace Image",hint:"Swap image source",tags:["IMG"]},link:{label:"üîó Replace Link",hint:"Change link URL",tags:["A"]},placeholder:{label:"üìù Change Placeholder",hint:"Modify placeholder text",tags:["INPUT","TEXTAREA"]},formAction:{label:"üì§ Change Form Action",hint:"Redirect form submission",tags:["FORM"]}};const y=["nv-css-panel","nv-text-panel","nv-hide-panel","nv-image-panel","nv-link-panel","nv-insertHtml-panel","nv-replaceHtml-panel","nv-resize-panel","nv-clone-panel","nv-reorder-panel","nv-move-panel","nv-attribute-panel","nv-class-panel","nv-clickRedirect-panel","nv-tooltip-panel","nv-sticky-panel","nv-placeholder-panel","nv-formAction-panel","nv-animation-panel"];function h(e){y.forEach(n=>{const t=document.getElementById(n);t&&(t.style.display=n===e?"block":"none")})}function f(e){try{let n;try{n=document.querySelectorAll(e.selector)}catch(t){if(!e.selector.includes(":"))throw t;{const t=e.selector.replace(/:/g,"\\:");n=document.querySelectorAll(t)}}n.forEach(n=>{const t=e.changes||{};switch(e.type){case"css":t.css&&Object.assign(n.style,t.css);break;case"text":void 0!==t.text&&(n.textContent=t.text);break;case"hide":n.style.display="none";break;case"remove":n.remove();break;case"clone":const e=t.cloneCount||1,a=t.clonePosition||"after";for(let t=0;t<e;t++){const e=n.cloneNode(!0);e.removeAttribute("id"),"before"===a?n.parentNode.insertBefore(e,n):n.parentNode.insertBefore(e,n.nextSibling)}break;case"image":if(t.imageUrl){const e=e=>{console.log("[navlens-editor] Replacing image:",e.src,"->",t.imageUrl),e.removeAttribute("srcset"),e.removeAttribute("data-srcset"),e.src=t.imageUrl,e.style.cssText+=`\n                  content: url(${t.imageUrl}) !important;\n                  object-fit: cover !important;\n                `,e.dataset.nvModified="true"};if("IMG"===n.tagName)e(n);else{n.querySelectorAll("img").forEach(e)}}break;case"link":t.linkUrl&&"A"===n.tagName&&(n.href=t.linkUrl,t.linkTarget&&(n.target=t.linkTarget));break;case"insertHtml":if(t.html){const e=t.insertPosition||"after";n.insertAdjacentHTML("before"===e?"beforebegin":"after"===e?"afterend":"prepend"===e?"afterbegin":"beforeend",t.html)}break;case"replaceHtml":t.html&&(n.outerHTML=t.html);break;case"resize":t.width&&(n.style.width=t.width),t.height&&(n.style.height=t.height);break;case"reorder":const i=n.parentNode,o=Array.from(i.children),l=Math.min(t.newIndex||0,o.length-1);i.insertBefore(n,o[l]);break;case"move":t.position&&(n.style.transform=`translate(${t.position.x}px, ${t.position.y}px)`);break;case"attribute":t.attributes&&Object.entries(t.attributes).forEach(([e,t])=>n.setAttribute(e,t));break;case"class":t.addClass&&t.addClass.forEach(e=>n.classList.add(e)),t.removeClass&&t.removeClass.forEach(e=>n.classList.remove(e));break;case"clickRedirect":t.redirectUrl&&(n.style.cursor="pointer",n.addEventListener("click",e=>{e.preventDefault(),window.location.href=t.redirectUrl}));break;case"tooltip":t.tooltipText&&(n.title=t.tooltipText);break;case"sticky":n.style.position="sticky",n.style.top=t.stickyTop||"0px",n.style.zIndex=t.stickyZIndex||1e3;break;case"placeholder":void 0!==t.placeholderText&&(n.placeholder=t.placeholderText);break;case"formAction":t.formActionUrl&&"FORM"===n.tagName&&(n.action=t.formActionUrl);break;case"animation":if(t.animationName){const e=t.animationDuration||"0.5s";"custom"===t.animationName&&t.animationCustom?(n.style.transition=`all ${e}`,Object.assign(n.style,function(e){const n={};return e.split(";").forEach(e=>{const[t,a]=e.split(":").map(e=>e.trim());if(t&&a){const e=t.replace(/-([a-z])/g,e=>e[1].toUpperCase());n[e]=a}}),n}(t.animationCustom))):n.style.animation=`${t.animationName} ${e}`}}})}catch(n){console.warn("[navlens-editor] Could not apply modification:",e.selector,n)}}function x(e){if(e.id)return`#${CSS.escape(e.id)}`;if("IMG"===e.tagName){const n=e.getAttribute("src")||"";if(n.includes("/_next/image"))try{const e=new URL(n,window.location.origin).searchParams.get("url");if(e){const n=decodeURIComponent(e).split("/").pop();if(n&&n.length>3)return console.log("[navlens-editor] Using Next.js image filename:",n),`img[src*="${CSS.escape(n)}"]`}}catch(e){console.warn("[navlens-editor] Failed to parse Next.js image URL")}if(n){const e=n.split("/").pop()?.split("?")[0];if(e&&e.length>3&&"image"!==e)return`img[src*="${CSS.escape(e)}"]`}const t=e.getAttribute("alt");if(t)return`img[alt="${CSS.escape(t)}"]`}if("A"===e.tagName){const n=e.getAttribute("href");if(n&&"#"!==n&&"/"!==n){const e=`a[href="${CSS.escape(n)}"]`,t=document.querySelectorAll(e);if(1===t.length)return e;console.log(`[navlens-editor] Multiple links with href="${n}" (${t.length}), using path-based selector`)}}let n=[],t=e;for(;t&&t.nodeType===Node.ELEMENT_NODE&&t!==document.body;){let e=t.tagName.toLowerCase();if("A"===t.tagName&&t.getAttribute("href")){const n=t.getAttribute("href");n&&"#"!==n&&"/"!==n&&(e+=`[href="${CSS.escape(n)}"]`)}const a=t.parentElement;if(a){const n=Array.from(a.children).filter(e=>e.tagName===t.tagName);if(n.length>1){e+=`:nth-of-type(${n.indexOf(t)+1})`}}if(t.className&&"string"==typeof t.className){const n=t.className.trim().split(/\s+/).filter(e=>e&&!e.startsWith("nv-")&&!e.startsWith("__")).slice(0,1);n.length&&(e+="."+n.map(e=>CSS.escape(e)).join("."))}const i=t.getAttribute("data-testid"),o=t.getAttribute("role");if(i?e+=`[data-testid="${CSS.escape(i)}"]`:o&&["button","link","navigation","main","header","footer"].includes(o)&&(e+=`[role="${o}"]`),n.unshift(e),t.id||n.length>=4)break;t=t.parentElement}return n.join(" > ")}function b(e){return null!==e.closest("#navlens-editor")}function E(e){const n=e.getBoundingClientRect();v.style.display="block",v.style.top=n.top+window.scrollY+"px",v.style.left=n.left+window.scrollX+"px",v.style.width=n.width+"px",v.style.height=n.height+"px"}function I(){i=null,v.classList.remove("nv-selected"),v.style.display="none",document.getElementById("nv-edit-panel").style.display="none",document.getElementById("nv-instructions").style.display="block",document.getElementById("nv-font-size").value="",document.getElementById("nv-new-text").value="",document.getElementById("nv-image-url").value="",document.getElementById("nv-image-preview").innerHTML="",document.getElementById("nv-link-url").value="",document.getElementById("nv-insert-html").value="",document.getElementById("nv-replace-html").value="",document.getElementById("nv-resize-width").value="",document.getElementById("nv-resize-height").value="",document.getElementById("nv-clone-count").value="1",document.getElementById("nv-reorder-index").value="0",document.getElementById("nv-move-x").value="0",document.getElementById("nv-move-y").value="0",document.getElementById("nv-attr-name").value="",document.getElementById("nv-attr-value").value="",document.getElementById("nv-class-add").value="",document.getElementById("nv-class-remove").value="",document.getElementById("nv-redirect-url").value="",document.getElementById("nv-tooltip-text").value="",document.getElementById("nv-placeholder-text").value="",document.getElementById("nv-form-action-url").value="",document.getElementById("nv-animation-name").value="",document.getElementById("nv-animation-custom").value=""}function k(){const e=document.getElementById("nv-mod-list");document.getElementById("nv-mod-count").textContent=l.length;const n={css:"üé® CSS",text:"‚úèÔ∏è Text",hide:"üëÅÔ∏è Hide",image:"üñºÔ∏è Image",link:"üîó Link",insertHtml:"‚ûï HTML",replaceHtml:"üîÑ HTML",resize:"üìê Resize",clone:"üìã Clone",reorder:"‚ÜïÔ∏è Reorder",move:"‚úã Move",attribute:"‚öôÔ∏è Attr",class:"üè∑Ô∏è Class",clickRedirect:"üñ±Ô∏è Click",tooltip:"üí¨ Tooltip",sticky:"üìå Sticky",placeholder:"üìù Placeholder",formAction:"üì§ Form",animation:"‚ú® Anim"};e.innerHTML=l.map((e,t)=>`\n      <div class="nv-mod-item">\n        <span>${n[e.type]||e.type}: ${e.selector.slice(0,25)}...</span>\n        <span class="nv-mod-delete" data-index="${t}">üóë</span>\n      </div>\n    `).join(""),e.querySelectorAll(".nv-mod-delete").forEach(e=>{e.addEventListener("click",e=>{const n=parseInt(e.target.dataset.index),t=l[n];t&&function(e){const n=u.get(e.id);if(n)try{document.querySelectorAll(e.selector).forEach(t=>{switch(e.type){case"css":case"hide":case"resize":case"sticky":case"move":case"attribute":t.setAttribute("style",n.style);break;case"text":t.textContent=n.textContent;break;case"image":"IMG"===t.tagName&&(t.src=n.src);break;case"link":"A"===t.tagName&&(t.href=n.href);break;case"placeholder":t.placeholder=n.placeholder;break;case"formAction":"FORM"===t.tagName&&(t.action=n.action);break;case"class":t.className=n.className;break;case"tooltip":t.title=n.title;break;case"animation":t.style.animation="",t.style.transition=""}delete t.dataset.nvApplied}),u.delete(e.id)}catch(e){console.warn("[navlens-editor] Could not restore original state:",e)}}(t),l.splice(n,1),k()})})}document.getElementById("nv-mod-type").addEventListener("change",e=>{const n=e.target.value;h(`nv-${n}-panel`);const t=document.getElementById("nv-type-hint"),a=g[n];if(t.textContent=a?a.hint:"","class"===n&&i){const e=Array.from(i.classList).filter(e=>!e.startsWith("nv-"));document.getElementById("nv-current-classes").textContent=e.length?`Current: ${e.join(", ")}`:"No classes"}}),document.getElementById("nv-animation-name").addEventListener("change",e=>{document.getElementById("nv-animation-custom-container").style.display="custom"===e.target.value?"block":"none"}),document.getElementById("nv-image-file").addEventListener("change",async e=>{const i=e.target.files[0];if(!i)return;const l=document.getElementById("nv-image-preview");l.innerHTML='<div style="color: #9ca3af; font-size: 11px;">Uploading...</div>';try{const e=new FormData;e.append("file",i),e.append("siteId",s),e.append("experimentId",n||""),e.append("variantId",t||""),e.append("timestamp",a||""),e.append("signature",o||"");const d=await fetch(`${r}/api/experiments/upload`,{method:"POST",mode:"cors",body:e});if(!d.ok){const e=await d.json();throw new Error(e.error||"Upload failed")}const c=await d.json();document.getElementById("nv-image-url").value=c.url,l.innerHTML=`<img src="${c.url}" class="nv-preview-img" alt="Preview">`}catch(e){l.innerHTML=`<div style="color: #ef4444; font-size: 11px;">Error: ${e.message}</div>`}}),document.getElementById("nv-image-url").addEventListener("blur",e=>{const n=e.target.value.trim(),t=document.getElementById("nv-image-preview");n&&n.startsWith("http")?t.innerHTML=`<img src="${n}" class="nv-preview-img" alt="Preview" onerror="this.style.display='none'">`:t.innerHTML=""}),async function(){try{const e=new URLSearchParams({experimentId:n,siteId:s,variantId:t||"",ts:a||"",sig:o||""});console.log("[navlens-editor] Loading modifications from:",`${r}/api/experiments/modifications?${e}`);const i=await fetch(`${r}/api/experiments/modifications?${e}`);if(!i.ok){const e=await i.json().catch(()=>({}));return void console.error("[navlens-editor] Failed to load modifications:",i.status,e)}const d=await i.json();if(d.modifications&&d.modifications.length>0){const e=t?d.modifications.filter(e=>e.variant_id===t):d.modifications;l=e,k(),l.forEach(e=>{f(e)}),console.log(`[navlens-editor] Loaded ${l.length} existing modifications`)}}catch(e){console.error("[navlens-editor] Could not load existing modifications:",e)}}(),document.addEventListener("mousemove",e=>{"navigate"===window.navlensInteractionMode||d||b(e.target)?v.style.display="none":E(e.target)}),document.addEventListener("click",e=>{if(b(e.target))return;if("navigate"===window.navlensInteractionMode)return;e.preventDefault(),e.stopPropagation();let n=e.target;if("IMG"!==n.tagName&&"A"!==n.tagName&&"INPUT"!==n.tagName){const e=n.querySelectorAll("img");1===e.length&&(n=e[0],console.log("[navlens-editor] Auto-targeting nested img element"));const t=n.querySelectorAll("a");1===t.length&&"IMG"!==n.tagName&&(n=t[0],console.log("[navlens-editor] Auto-targeting nested link element"))}i=n,v.classList.add("nv-selected"),E(i),document.getElementById("nv-instructions").style.display="none",document.getElementById("nv-edit-panel").style.display="block",document.getElementById("nv-selected-tag").textContent=`<${i.tagName.toLowerCase()}>`,document.getElementById("nv-selected-selector").textContent=x(i);const t=window.getComputedStyle(i);document.getElementById("nv-bg-color-text").value=t.backgroundColor,document.getElementById("nv-text-color-text").value=t.color,function(e){const n=document.getElementById("nv-mod-type"),t=document.getElementById("nv-type-hint"),a=e.tagName.toUpperCase();n.innerHTML="";const i=document.createElement("optgroup");i.label="All Elements",Object.entries(g).forEach(([e,n])=>{if(n.universal){const t=document.createElement("option");t.value=e,t.textContent=n.label,i.appendChild(t)}}),n.appendChild(i);const o=[];if(("IMG"===a||e.querySelector("img"))&&o.push(["image",g.image]),("A"===a||e.querySelector("a"))&&o.push(["link",g.link]),("INPUT"===a||"TEXTAREA"===a||e.querySelector("input, textarea"))&&o.push(["placeholder",g.placeholder]),("FORM"===a||e.querySelector("form"))&&o.push(["formAction",g.formAction]),o.length>0){const e=document.createElement("optgroup"),t="IMG"===a?"IMG Specific":"A"===a?"Link Specific":"Contains Special Elements";e.label=t,o.forEach(([n,t])=>{const a=document.createElement("option");a.value=n,a.textContent=t.label,e.appendChild(a)}),n.appendChild(e),n.value=o[0][0]}const l=g[n.value];t.textContent=l?l.hint:"",h(`nv-${n.value}-panel`)}(i);const a=Array.from(i.classList).filter(e=>!e.startsWith("nv-"));document.getElementById("nv-current-classes").textContent=a.length?`Current: ${a.join(", ")}`:"No classes"},!0),["bg","text"].forEach(e=>{document.getElementById(`nv-${e}-color`).addEventListener("input",n=>{document.getElementById(`nv-${e}-color-text`).value=n.target.value}),document.getElementById(`nv-${e}-color-text`).addEventListener("input",n=>{document.getElementById(`nv-${e}-color`).value=n.target.value})}),document.getElementById("nv-add-mod").addEventListener("click",()=>{if(!i)return;const e=document.getElementById("nv-mod-type").value,n=x(i),a={id:"mod_"+Date.now(),variant_id:t||"variant_0",selector:n,type:e,changes:{}};switch(e){case"css":a.changes.css={};const e=document.getElementById("nv-bg-color-text").value,n=document.getElementById("nv-text-color-text").value,t=document.getElementById("nv-font-size").value;e&&(a.changes.css.backgroundColor=e),n&&(a.changes.css.color=n),t&&(a.changes.css.fontSize=t);break;case"text":a.changes.text=document.getElementById("nv-new-text").value;break;case"hide":case"remove":break;case"image":a.changes.imageUrl=document.getElementById("nv-image-url").value,console.log("[navlens-editor] Adding image modification:",{selector:a.selector,imageUrl:a.changes.imageUrl,selectedElement:i.tagName});break;case"link":a.changes.linkUrl=document.getElementById("nv-link-url").value,a.changes.linkTarget=document.getElementById("nv-link-target").value;break;case"insertHtml":a.changes.html=document.getElementById("nv-insert-html").value,a.changes.insertPosition=document.getElementById("nv-insert-position").value;break;case"replaceHtml":a.changes.html=document.getElementById("nv-replace-html").value;break;case"resize":a.changes.width=document.getElementById("nv-resize-width").value,a.changes.height=document.getElementById("nv-resize-height").value;break;case"clone":a.changes.cloneCount=parseInt(document.getElementById("nv-clone-count").value)||1,a.changes.clonePosition=document.getElementById("nv-clone-position").value||"after";break;case"reorder":a.changes.newIndex=parseInt(document.getElementById("nv-reorder-index").value)||0;break;case"move":a.changes.position={x:parseInt(document.getElementById("nv-move-x").value)||0,y:parseInt(document.getElementById("nv-move-y").value)||0};break;case"attribute":a.changes.attributes={};const o=document.getElementById("nv-attr-name").value.trim(),l=document.getElementById("nv-attr-value").value;o&&(a.changes.attributes[o]=l);break;case"class":const s=document.getElementById("nv-class-add").value.split(",").map(e=>e.trim()).filter(Boolean),r=document.getElementById("nv-class-remove").value.split(",").map(e=>e.trim()).filter(Boolean);s.length&&(a.changes.addClass=s),r.length&&(a.changes.removeClass=r);break;case"clickRedirect":a.changes.redirectUrl=document.getElementById("nv-redirect-url").value;break;case"tooltip":a.changes.tooltipText=document.getElementById("nv-tooltip-text").value,a.changes.tooltipPosition=document.getElementById("nv-tooltip-position").value;break;case"sticky":a.changes.stickyTop=document.getElementById("nv-sticky-top").value,a.changes.stickyZIndex=parseInt(document.getElementById("nv-sticky-zindex").value)||1e3;break;case"placeholder":a.changes.placeholderText=document.getElementById("nv-placeholder-text").value;break;case"formAction":a.changes.formActionUrl=document.getElementById("nv-form-action-url").value;break;case"animation":a.changes.animationName=document.getElementById("nv-animation-name").value,a.changes.animationDuration=document.getElementById("nv-animation-duration").value,a.changes.animationIteration=document.getElementById("nv-animation-iteration").value||"1",a.changes.animationDelay=document.getElementById("nv-animation-delay").value||"0s","custom"===a.changes.animationName&&(a.changes.animationCustom=document.getElementById("nv-animation-custom").value)}var o,s;o=i,s=a.id,u.has(s)||u.set(s,{outerHTML:o.outerHTML,style:o.getAttribute("style")||"",textContent:o.textContent,src:o.src,href:o.href,placeholder:o.placeholder,action:o.action,className:o.className,title:o.title}),f(a),l.push(a),k(),I()}),document.getElementById("nv-cancel").addEventListener("click",()=>{I()}),document.getElementById("nv-save").addEventListener("click",async()=>{if(!l.length)return void alert("No changes to save");const e=document.getElementById("nv-save");e.disabled=!0,e.textContent="‚è≥ Saving...";try{const i=await fetch(`${r}/api/experiments/modifications`,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({experimentId:n,siteId:s,variantId:t,timestamp:a,signature:o,modifications:l})});if(i.ok)e.textContent="‚úÖ Saved!",setTimeout(()=>{e.textContent="üíæ Save All Changes",e.disabled=!1},2e3);else{const n=await i.json();alert("Save failed: "+(n.error||"Unknown error")),e.textContent="üíæ Save All Changes",e.disabled=!1}}catch(n){alert("Save failed: "+n.message),e.textContent="üíæ Save All Changes",e.disabled=!1}}),document.getElementById("nv-close").addEventListener("click",()=>{if(l.length&&!confirm("You have unsaved changes. Close anyway?"))return;const e=new URL(window.location);e.searchParams.delete("__navlens_editor"),e.searchParams.delete("__variant"),e.searchParams.delete("__ts"),e.searchParams.delete("__sig"),window.location.href=e.toString()}),m.addEventListener("mousedown",()=>{d=!0}),document.addEventListener("mouseup",()=>{d=!1}),window.navlensInteractionMode="edit";let w=null,S=null;function C(e){["edit","drag","navigate"].forEach(n=>{const t=document.getElementById(`nv-mode-${n}`);t&&(n===e?(t.style.background="#3b82f6",t.style.color="white"):(t.style.background="transparent",t.style.color="#9ca3af"))}),v.style.display="none"}function B(){document.querySelectorAll('[draggable="true"]').forEach(e=>{b(e)||(e.removeAttribute("draggable"),e.style.cursor="")})}document.getElementById("nv-mode-edit").addEventListener("click",()=>{window.navlensInteractionMode="edit",C("edit"),B()}),document.getElementById("nv-mode-drag").addEventListener("click",()=>{window.navlensInteractionMode="drag",C("drag"),document.querySelectorAll("div, section, article, aside, header, footer, nav, main, p, h1, h2, h3, h4, h5, h6, ul, ol, li, a, button, img").forEach(e=>{b(e)||(e.setAttribute("draggable","true"),e.style.cursor="grab")}),console.log("[navlens-editor] Drag mode enabled")}),document.getElementById("nv-mode-navigate").addEventListener("click",()=>{window.navlensInteractionMode="navigate",C("navigate"),B()}),document.addEventListener("dragstart",e=>{"drag"!==window.navlensInteractionMode||b(e.target)||(w=e.target,S=x(w),e.target.style.opacity="0.5",e.dataTransfer.effectAllowed="move",console.log("[navlens-editor] Dragging:",S))}),document.addEventListener("dragend",e=>{"drag"===window.navlensInteractionMode&&(e.target.style.opacity="",w=null,document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove()))}),document.addEventListener("dragover",e=>{if("drag"!==window.navlensInteractionMode||!w)return;e.preventDefault(),e.dataTransfer.dropEffect="move";const n=e.target;if(n===w||b(n)||["HTML","HEAD","SCRIPT","STYLE","LINK","META","NOSCRIPT","IFRAME"].includes(n.tagName))return void document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove());document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove());const t=function(e,n){const t=e.parentNode,a=n.parentNode;if(t===a)return"sibling";const i=window.getComputedStyle(e),o="flex"===i.display||"grid"===i.display||"block"===i.display||"DIV"===e.tagName||"SECTION"===e.tagName||"MAIN"===e.tagName||"ARTICLE"===e.tagName||"UL"===e.tagName||"OL"===e.tagName,l=e.tagName===n.tagName||e.className&&n.className&&e.className.split(" ").some(e=>n.className.includes(e)),s=t&&a&&(t.tagName===a.tagName||t.className&&a.className&&t.className.split(" ").some(e=>a.className.includes(e))),r=window.getComputedStyle(n),d=["inline","inline-block"].includes(i.display),c=["block","flex","grid"].includes(r.display);if(d&&c)return"risky";if(o&&(l||s))return"container";if(l)return"similar";if(o)return"generic";return"generic"}(n,w),a={container:"#22c55e",sibling:"#3b82f6",similar:"#3b82f6",generic:"#eab308",risky:"#ef4444"},i=n.getBoundingClientRect(),o=i.top+i.height/2,l=e.clientY<o?"before":"after",s=document.createElement("div");s.className="nv-drop-indicator",s.style.cssText=`\n      position: absolute;\n      left: ${i.left}px;\n      width: ${i.width}px;\n      height: 4px;\n      background: ${a[t]||a.generic};\n      z-index: 10000;\n      pointer-events: none;\n      top: ${"before"===l?i.top+window.scrollY:i.bottom+window.scrollY}px;\n      box-shadow: 0 0 6px ${a[t]||a.generic};\n    `,document.body.appendChild(s),n.dataset.nvDropPosition=l,n.dataset.nvDropType=t}),document.addEventListener("drop",e=>{if("drag"!==window.navlensInteractionMode||!w)return;e.preventDefault();const n=e.target;if(n===w||b(n))return;const a=n.dataset.nvDropPosition||"after",i=n.dataset.nvDropType||"generic";delete n.dataset.nvDropPosition,delete n.dataset.nvDropType,document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove()),console.log(`[navlens-editor] Dropping with zone type: ${i}`);const o=n.parentNode;"before"===a?o.insertBefore(w,n):o.insertBefore(w,n.nextSibling),L();const s={id:"mod_"+Date.now(),variant_id:t||"variant_0",selector:S,type:"dragMove",changes:{targetSelector:x(n),position:a}};l.push(s),k(),console.log("[navlens-editor] Moved element:",S,a,"target")});const N=[],A=[];function L(){N.push(JSON.parse(JSON.stringify(l))),A.length=0,T()}function T(){document.getElementById("nv-undo").disabled=0===N.length,document.getElementById("nv-redo").disabled=0===A.length}function M(){if(0===N.length)return;A.push(JSON.parse(JSON.stringify(l)));const e=N.pop();sessionStorage.setItem("nv-pending-mods",JSON.stringify(e)),sessionStorage.setItem("nv-redo-stack",JSON.stringify(A)),sessionStorage.setItem("nv-undo-stack",JSON.stringify(N)),location.reload()}function z(){if(0===A.length)return;N.push(JSON.parse(JSON.stringify(l)));const e=A.pop();sessionStorage.setItem("nv-pending-mods",JSON.stringify(e)),sessionStorage.setItem("nv-redo-stack",JSON.stringify(A)),sessionStorage.setItem("nv-undo-stack",JSON.stringify(N)),location.reload()}const P=sessionStorage.getItem("nv-pending-mods");if(P)try{const e=JSON.parse(P);l.length=0,e.forEach(e=>l.push(e)),k(),l.forEach(f);const n=sessionStorage.getItem("nv-undo-stack"),t=sessionStorage.getItem("nv-redo-stack");n&&N.push(...JSON.parse(n)),t&&A.push(...JSON.parse(t)),T(),sessionStorage.removeItem("nv-pending-mods"),sessionStorage.removeItem("nv-undo-stack"),sessionStorage.removeItem("nv-redo-stack"),console.log("[navlens-editor] Restored state after undo/redo")}catch(e){console.warn("[navlens-editor] Failed to restore pending mods:",e)}document.getElementById("nv-undo").addEventListener("click",M),document.getElementById("nv-redo").addEventListener("click",z),document.addEventListener("keydown",e=>{e.ctrlKey&&"z"===e.key&&(e.shiftKey?(e.preventDefault(),z()):(e.preventDefault(),M()))}),document.getElementById("nv-add-mod").addEventListener("click",()=>{L()},!0);const R=document.createElement("button");R.id="nv-floating-btn",R.innerHTML="üß™",R.title="Open Navlens Editor",R.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: #3b82f6;\n    color: white;\n    border: none;\n    font-size: 24px;\n    cursor: pointer;\n    z-index: 10002;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    display: none;\n  ",p.appendChild(R),document.getElementById("nv-minimize").addEventListener("click",()=>{m.style.display="none",R.style.display="block"}),R.addEventListener("click",()=>{m.style.display="block",R.style.display="none"}),console.log("[navlens-editor] Visual editor loaded with 23 modification types + UX controls")})}();