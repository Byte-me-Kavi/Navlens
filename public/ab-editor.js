!function(){"use strict";const e=new URLSearchParams(window.location.search);if(!e.has("__navlens_editor"))return;const n=e.get("__navlens_editor"),t=e.get("__variant"),o=e.get("__ts"),i=e.get("__token"),a=e.get("__sig"),l=document.querySelector("script[data-site-id]"),s=l?.dataset.siteId,r=l?.dataset.apiHost||l?.src.replace(/\/tracker\.js.*/,"");if(!s||!r)return void console.error("[navlens-editor] Missing site ID or API host");const d=r.includes("://")?r:`https://${r}`;(async function(){if(!a||!o||!i)return alert("Invalid editor link. Please generate a new link from the dashboard."),console.error("[navlens-editor] Missing signature, timestamp, or token"),!1;const e=parseInt(o,10),l=Date.now()-e;if(l>36e5||l<0)return alert("Editor link has expired. Please generate a new link from the dashboard."),console.error("[navlens-editor] Editor URL expired"),!1;try{const e=await fetch(`${d}/api/experiments/verify-editor`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({experimentId:n,variantId:t,timestamp:o,token:i,signature:a})}),l=await e.json();return l.valid?(console.log("[navlens-editor] Signature verified successfully"),!0):(alert(`Editor access denied: ${l.error||"Invalid signature"}. Please generate a new link.`),console.error("[navlens-editor] Signature verification failed:",l.error),!1)}catch(e){return console.error("[navlens-editor] Verification request failed:",e),alert("Could not verify editor access. Please check your connection and try again."),!1}})().then(e=>{if(!e)return;let i=null,l=[],d=!1;const c=document.createElement("style");c.id="navlens-editor-styles",c.textContent="\n    .nv-editor-overlay {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      min-height: 100%;\n      pointer-events: none;\n      z-index: 999999;\n    }\n    \n    .nv-highlight {\n      position: absolute;\n      pointer-events: none;\n      border: 2px dashed #4f46e5;\n      background: rgba(79, 70, 229, 0.1);\n      transition: all 0.1s ease;\n      z-index: 999998;\n    }\n    \n    .nv-selected {\n      border: 2px solid #4f46e5 !important;\n      background: rgba(79, 70, 229, 0.1) !important;\n    }\n    \n    .nv-toolbar {\n      position: fixed;\n      top: 10px;\n      right: 10px;\n      background: #ffffff;\n      color: #1f2937;\n      padding: 16px;\n      border-radius: 12px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      font-size: 14px;\n      z-index: 1000000;\n      pointer-events: auto;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0,0,0,0.05);\n      min-width: 320px;\n      max-width: 380px;\n      max-height: 90vh;\n      overflow-y: auto;\n    }\n    \n    .nv-toolbar-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      margin-bottom: 16px;\n      padding-bottom: 12px;\n      border-bottom: 1px solid #e5e7eb;\n    }\n    \n    .nv-toolbar-title {\n      font-weight: 600;\n      color: #111827;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n    \n    .nv-btn {\n      padding: 8px 12px;\n      border: 1px solid #d1d5db;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 500;\n      transition: all 0.2s;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n      background: white;\n      color: #374151;\n    }\n    \n    .nv-btn:hover {\n      background: #f9fafb;\n      border-color: #9ca3af;\n    }\n\n    .nv-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n    \n    .nv-btn-primary {\n      background: #4f46e5;\n      color: white;\n      border: 1px solid transparent;\n      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);\n    }\n    \n    .nv-btn-primary:hover {\n      background: #4338ca;\n      border-color: transparent;\n    }\n    \n    .nv-btn-success {\n      background: #4f46e5; /* Using Indigo for save actions too for consistency */\n      color: white;\n      border: 1px solid transparent;\n    }\n    \n    .nv-btn-danger {\n      background: white;\n      color: #ef4444;\n      border-color: #fee2e2;\n    }\n    \n    .nv-btn-danger:hover {\n      background: #fef2f2;\n      border-color: #fca5a5;\n    }\n    \n    .nv-btn-secondary {\n      background: white;\n      color: #374151;\n      border: 1px solid #d1d5db;\n    }\n    \n    .nv-panel {\n      margin-top: 16px;\n    }\n    \n    .nv-panel-section {\n      margin-bottom: 16px;\n    }\n    \n    .nv-panel-label {\n      font-size: 12px;\n      font-weight: 500;\n      color: #374151;\n      margin-bottom: 6px;\n    }\n    \n    .nv-input {\n      width: 100%;\n      padding: 8px 12px;\n      border: 1px solid #d1d5db;\n      border-radius: 6px;\n      background: white;\n      color: #111827;\n      font-size: 13px;\n      box-sizing: border-box;\n      transition: border-color 0.15s;\n    }\n    \n    .nv-input:focus {\n      outline: none;\n      border-color: #4f46e5;\n      ring: 2px solid #e0e7ff;\n    }\n    \n    .nv-color-row {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n    }\n    \n    .nv-color-input {\n      width: 40px;\n      height: 34px;\n      border: 1px solid #d1d5db;\n      padding: 2px;\n      cursor: pointer;\n      border-radius: 6px;\n      background: white;\n    }\n    \n    .nv-selector-display {\n      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;\n      font-size: 11px;\n      color: #6b7280;\n      margin-top: 4px;\n      padding: 4px 8px;\n      background: #f3f4f6;\n      border-radius: 4px;\n      word-break: break-all;\n    }\n    \n    .nv-mod-list {\n      max-height: 200px;\n      overflow-y: auto;\n      margin-top: 12px;\n      border: 1px solid #e5e7eb;\n      border-radius: 6px;\n    }\n    \n    .nv-mod-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 8px 12px;\n      background: white;\n      border-bottom: 1px solid #f3f4f6;\n      font-size: 13px;\n      color: #374151;\n    }\n\n    .nv-mod-item:last-child {\n      border-bottom: none;\n    }\n    \n    .nv-mod-delete {\n      color: #9ca3af;\n      cursor: pointer;\n      padding: 4px;\n      border-radius: 4px;\n    }\n    \n    .nv-mod-delete:hover {\n      color: #ef4444;\n      background: #fef2f2;\n    }\n\n    .nv-row {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n    }\n\n    .nv-file-input {\n      display: none;\n    }\n\n    .nv-file-btn {\n      display: inline-flex;\n      align-items: center;\n      gap: 4px;\n      padding: 8px 12px;\n      background: white;\n      border: 1px solid #d1d5db;\n      color: #374151;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 500;\n      width: 100%;\n      justify-content: center;\n    }\n\n    .nv-file-btn:hover {\n      background: #f9fafb;\n      border-color: #9ca3af;\n    }\n\n    .nv-preview-img {\n      max-width: 100%;\n      max-height: 100px;\n      border-radius: 6px;\n      margin-top: 12px;\n      border: 1px solid #e5e7eb;\n    }\n\n    .nv-type-group {\n      padding: 4px 0;\n      border-bottom: 1px solid #e5e7eb;\n    }\n\n    .nv-type-group:last-child {\n      border-bottom: none;\n    }\n\n    .nv-type-group-label {\n      font-size: 11px;\n      color: #6b7280;\n      padding: 6px 8px;\n      font-weight: 600;\n      background: #f9fafb;\n    }\n\n    .nv-checkbox-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 4px 0;\n    }\n\n    .nv-checkbox-row input[type=\"checkbox\"] {\n      width: 16px;\n      height: 16px;\n    }\n\n    .nv-two-col {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n    }\n\n    .nv-tabs {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 12px;\n      background: #f3f4f6;\n      padding: 4px;\n      border-radius: 8px;\n    }\n\n    .nv-tab {\n      padding: 6px 12px;\n      font-size: 12px;\n      font-weight: 500;\n      border-radius: 6px;\n      cursor: pointer;\n      flex: 1;\n      text-align: center;\n      color: #6b7280;\n      transition: all 0.2s;\n    }\n\n    .nv-tab.active {\n      background: white;\n      color: #4f46e5;\n      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);\n    }\n  ",document.head.appendChild(c);const p=document.createElement("style");p.textContent="\n    .nv-icon {\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      vertical-align: middle;\n      line-height: 1;\n    }\n    .nv-icon svg {\n      width: 14px;\n      height: 14px;\n      stroke-width: 2px;\n    }\n    /* Specific icon sizes */\n    .nv-mode-btn .nv-icon svg { width: 12px; height: 12px; }\n    .nv-toolbar-title .nv-icon svg { width: 16px; height: 16px; }\n    .nv-btn .nv-icon svg { width: 14px; height: 14px; margin-right: 4px; }\n  ",document.head.appendChild(p);const v={flask:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2v7.31"/><path d="M14 2v7.31"/><path d="M8.5 2h7"/><path d="M14 9.3a6.5 6.5 0 1 1-4 0"/></svg>',minimize:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>',close:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',edit:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',drag:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M15.5 10.5 12 7l-3.5 3.5"/><path d="M12 17V7"/><path d="M5 12h14"/></svg>',nav:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>',undo:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>',redo:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 3.7"/></svg>',css:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="10.5" r="2.5"/><circle cx="8.5" cy="7.5" r="2.5"/><circle cx="6.5" cy="12.5" r="2.5"/><path d="M12 12c-3 0-6 3-6 7s3 7 7 7 6-3 6-7-4-7-7-7z"/></svg>',text:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>',hide:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>',remove:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>',clone:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>',insert:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',replace:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="m3 3 7.53 3.8a5 5 0 1 1 5 6.5"/></svg>',resize:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 3v18"/><path d="M21 9H3"/></svg>',reorder:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/><polyline points="19 12 12 5 5 12"/></svg>',move:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="19 9 22 12 19 15"/><polyline points="9 19 12 22 15 19"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></svg>',attr:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>',class:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>',tooltip:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>',sticky:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="17" x2="12" y2="22"/><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"/></svg>',anim:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',click:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="M13 13l6 6"/></svg>',image:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>',link:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',placeholder:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>',form:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>',warning:'<svg viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',save:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>',trash:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>'};function m(e,n=""){return v[e]?`<span class="nv-icon ${n}">${v[e]}</span>`:""}const u=document.createElement("div");u.className="nv-editor-overlay",u.id="navlens-editor";const g=document.createElement("div");g.className="nv-highlight",g.style.display="none",u.appendChild(g);const y=document.createElement("div");y.className="nv-toolbar",y.innerHTML=`\n    <div class="nv-toolbar-header">\n      <span class="nv-toolbar-title">${m("flask")} Navlens Editor</span>\n      <div style="display: flex; gap: 4px;">\n        <button class="nv-btn" id="nv-minimize" title="Minimize to floating button">${m("minimize")}</button>\n        <button class="nv-btn nv-btn-danger" id="nv-close">${m("close")}</button>\n      </div>\n    </div>\n    \n    \x3c!-- Mode & Viewport Controls --\x3e\n    <div style="display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap;">\n      <div style="flex: 1; min-width: 160px;">\n        <div class="nv-panel-label" style="margin-bottom: 4px;">Mode</div>\n        <div class="nv-tabs">\n          <div id="nv-mode-edit" class="nv-tab active">${m("edit","mr-1")} Edit</div>\n          <div id="nv-mode-drag" class="nv-tab">${m("drag","mr-1")} Drag</div>\n          <div id="nv-mode-navigate" class="nv-tab">${m("nav","mr-1")} Nav</div>\n        </div>\n      </div>\n    </div>\n    \n    \x3c!-- Undo/Redo Row --\x3e\n    <div style="display: flex; gap: 8px; margin-bottom: 10px;">\n      <button id="nv-undo" class="nv-btn" style="flex:1;" disabled title="Undo (Ctrl+Z)">${m("undo")} Undo</button>\n      <button id="nv-redo" class="nv-btn" style="flex:1;" disabled title="Redo (Ctrl+Shift+Z)">${m("redo")} Redo</button>\n    </div>\n    \n    <div id="nv-instructions" style="color: #9ca3af; font-size: 12px;">\n      Click on any element to select it\n    </div>\n    \n    <div id="nv-edit-panel" class="nv-panel" style="display: none;">\n      <div class="nv-panel-section">\n        <div class="nv-panel-label">Selected Element</div>\n        <div id="nv-selected-tag" style="font-weight: 600;"></div>\n        <div id="nv-selected-selector" class="nv-selector-display"></div>\n      </div>\n      \n      <div class="nv-panel-section">\n        <div class="nv-panel-label">Modification Type</div>\n        <select id="nv-mod-type" class="nv-input">\n          \x3c!-- Options populated dynamically based on selected element --\x3e\n        </select>\n        <div id="nv-type-hint" style="font-size: 10px; color: #6b7280; margin-top: 4px;"></div>\n      </div>\n      \n      \x3c!-- CSS Panel --\x3e\n      <div id="nv-css-panel" class="nv-panel-section">\n        <div class="nv-panel-label">Background Color</div>\n        <div class="nv-color-row">\n          <input type="color" id="nv-bg-color" class="nv-color-input" value="#ffffff">\n          <input type="text" id="nv-bg-color-text" class="nv-input" placeholder="#ffffff" style="flex:1;">\n        </div>\n        \n        <div class="nv-panel-label" style="margin-top: 8px;">Text Color</div>\n        <div class="nv-color-row">\n          <input type="color" id="nv-text-color" class="nv-color-input" value="#000000">\n          <input type="text" id="nv-text-color-text" class="nv-input" placeholder="#000000" style="flex:1;">\n        </div>\n        \n        <div class="nv-panel-label" style="margin-top: 8px;">Font Size</div>\n        <input type="text" id="nv-font-size" class="nv-input" placeholder="e.g., 16px">\n      </div>\n      \n      \x3c!-- Text Panel --\x3e\n      <div id="nv-text-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New Text</div>\n        <textarea id="nv-new-text" class="nv-input" rows="3" placeholder="Enter replacement text..."></textarea>\n      </div>\n\n      \x3c!-- Hide Panel --\x3e\n      <div id="nv-hide-panel" class="nv-panel-section" style="display: none;">\n        <div style="color: #d97706; font-size: 12px; display: flex; gap: 6px; align-items: start; background: #fffbeb; padding: 8px; rounded: 4px; border: 1px solid #fcd34d;">\n          ${m("warning")} <span>This will hide the selected element (CSS display: none). Element stays in DOM.</span>\n        </div>\n      </div>\n\n      \x3c!-- Remove Panel (Hard Delete) --\x3e\n      <div id="nv-remove-panel" class="nv-panel-section" style="display: none;">\n        <div style="color: #dc2626; font-size: 12px; display: flex; gap: 6px; align-items: start; background: #fef2f2; padding: 8px; rounded: 4px; border: 1px solid #fecaca;">\n          ${m("trash")} <span>This will <strong>permanently remove</strong> the element from the DOM for this variant.</span>\n        </div>\n      </div>\n\n      \x3c!-- Clone Panel --\x3e\n      <div id="nv-clone-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Number of Clones</div>\n        <input type="number" id="nv-clone-count" class="nv-input" min="1" max="10" value="1" placeholder="1-10">\n        <div class="nv-panel-label" style="margin-top: 8px;">Position</div>\n        <select id="nv-clone-position" class="nv-input">\n          <option value="after">After Original</option>\n          <option value="before">Before Original</option>\n        </select>\n      </div>\n\n      \x3c!-- Image Panel --\x3e\n      <div id="nv-image-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Image URL</div>\n        <input type="text" id="nv-image-url" class="nv-input" placeholder="https://example.com/image.jpg">\n        <div style="margin: 8px 0; text-align: center; color: #6b7280; font-size: 11px;">â€” OR â€”</div>\n        <label class="nv-file-btn">\n          ${m("image")} Upload Image\n          <input type="file" id="nv-image-file" class="nv-file-input" accept="image/*">\n        </label>\n        <div id="nv-image-preview"></div>\n      </div>\n\n      \x3c!-- Link Panel --\x3e\n      <div id="nv-link-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Link URL</div>\n        <input type="text" id="nv-link-url" class="nv-input" placeholder="https://example.com/page">\n        <div class="nv-panel-label" style="margin-top: 8px;">Open In</div>\n        <select id="nv-link-target" class="nv-input">\n          <option value="_self">Same Tab</option>\n          <option value="_blank">New Tab</option>\n        </select>\n      </div>\n\n      \x3c!-- Insert HTML Panel --\x3e\n      <div id="nv-insertHtml-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Position</div>\n        <select id="nv-insert-position" class="nv-input">\n          <option value="before">Before Element</option>\n          <option value="after">After Element</option>\n          <option value="prepend">Inside (Start)</option>\n          <option value="append">Inside (End)</option>\n        </select>\n        <div class="nv-panel-label" style="margin-top: 8px;">HTML Code</div>\n        <textarea id="nv-insert-html" class="nv-input" rows="4" placeholder="<div>Your HTML here</div>" style="font-family: monospace;"></textarea>\n      </div>\n\n      \x3c!-- Replace HTML Panel --\x3e\n      <div id="nv-replaceHtml-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New HTML</div>\n        <textarea id="nv-replace-html" class="nv-input" rows="4" placeholder="<div>Replacement HTML</div>" style="font-family: monospace;"></textarea>\n        <div style="color: #d97706; font-size: 11px; margin-top: 4px; display: flex; gap: 4px; align-items: center;">\n          ${m("warning")} This replaces the entire element with your HTML.\n        </div>\n      </div>\n\n      \x3c!-- Resize Panel --\x3e\n      <div id="nv-resize-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-two-col">\n          <div>\n            <div class="nv-panel-label">Width</div>\n            <input type="text" id="nv-resize-width" class="nv-input" placeholder="e.g., 200px or 50%">\n          </div>\n          <div>\n            <div class="nv-panel-label">Height</div>\n            <input type="text" id="nv-resize-height" class="nv-input" placeholder="e.g., 100px or auto">\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Clone Panel --\x3e\n      <div id="nv-clone-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Number of Copies</div>\n        <input type="number" id="nv-clone-count" class="nv-input" value="1" min="1" max="10">\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Copies will be inserted after the original element.\n        </div>\n      </div>\n\n      \x3c!-- Reorder Panel --\x3e\n      <div id="nv-reorder-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Move to Position</div>\n        <input type="number" id="nv-reorder-index" class="nv-input" value="0" min="0">\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Position among siblings (0 = first).\n        </div>\n      </div>\n\n      \x3c!-- Move Panel --\x3e\n      <div id="nv-move-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-two-col">\n          <div>\n            <div class="nv-panel-label">X Offset (px)</div>\n            <input type="number" id="nv-move-x" class="nv-input" value="0">\n          </div>\n          <div>\n            <div class="nv-panel-label">Y Offset (px)</div>\n            <input type="number" id="nv-move-y" class="nv-input" value="0">\n          </div>\n        </div>\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Uses CSS transform to offset the element.\n        </div>\n      </div>\n\n      \x3c!-- Attribute Panel --\x3e\n      <div id="nv-attribute-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Attribute Name</div>\n        <input type="text" id="nv-attr-name" class="nv-input" placeholder="e.g., data-custom, title, aria-label">\n        <div class="nv-panel-label" style="margin-top: 8px;">Attribute Value</div>\n        <input type="text" id="nv-attr-value" class="nv-input" placeholder="Value to set">\n      </div>\n\n      \x3c!-- Class Panel --\x3e\n      <div id="nv-class-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Add Classes</div>\n        <input type="text" id="nv-class-add" class="nv-input" placeholder="class1, class2">\n        <div class="nv-panel-label" style="margin-top: 8px;">Remove Classes</div>\n        <input type="text" id="nv-class-remove" class="nv-input" placeholder="class1, class2">\n        <div id="nv-current-classes" style="font-size: 11px; color: #6b7280; margin-top: 4px;"></div>\n      </div>\n\n      \x3c!-- Click Redirect Panel --\x3e\n      <div id="nv-clickRedirect-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Redirect URL</div>\n        <input type="text" id="nv-redirect-url" class="nv-input" placeholder="https://example.com/page">\n        <div style="color: #9ca3af; font-size: 11px; margin-top: 4px;">\n          Clicking this element will navigate to the URL.\n        </div>\n      </div>\n\n      \x3c!-- Tooltip Panel --\x3e\n      <div id="nv-tooltip-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Tooltip Text</div>\n        <textarea id="nv-tooltip-text" class="nv-input" rows="2" placeholder="Hover text..."></textarea>\n        <div class="nv-panel-label" style="margin-top: 8px;">Position</div>\n        <select id="nv-tooltip-position" class="nv-input">\n          <option value="top">Top</option>\n          <option value="bottom">Bottom</option>\n          <option value="left">Left</option>\n          <option value="right">Right</option>\n        </select>\n      </div>\n\n      \x3c!-- Sticky Panel --\x3e\n      <div id="nv-sticky-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Stick to Top</div>\n        <input type="text" id="nv-sticky-top" class="nv-input" placeholder="e.g., 0px or 20px" value="0px">\n        <div class="nv-panel-label" style="margin-top: 8px;">Z-Index</div>\n        <input type="number" id="nv-sticky-zindex" class="nv-input" value="1000" min="1" max="9999999">\n      </div>\n\n      \x3c!-- Placeholder Panel --\x3e\n      <div id="nv-placeholder-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New Placeholder Text</div>\n        <input type="text" id="nv-placeholder-text" class="nv-input" placeholder="Enter new placeholder...">\n      </div>\n\n      \x3c!-- Form Action Panel --\x3e\n      <div id="nv-formAction-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">New Form Action URL</div>\n        <input type="text" id="nv-form-action-url" class="nv-input" placeholder="https://example.com/submit">\n        <div style="color: #d97706; font-size: 11px; margin-top: 4px; display: flex; gap: 4px; align-items: center;">\n          ${m("warning")} Only applies to form elements.\n        </div>\n      </div>\n\n      \x3c!-- Animation Panel --\x3e\n      <div id="nv-animation-panel" class="nv-panel-section" style="display: none;">\n        <div class="nv-panel-label">Animation Name</div>\n        <select id="nv-animation-name" class="nv-input">\n          <option value="">Select animation...</option>\n          <option value="fadeIn">Fade In</option>\n          <option value="fadeOut">Fade Out</option>\n          <option value="slideInLeft">Slide In Left</option>\n          <option value="slideInRight">Slide In Right</option>\n          <option value="slideInUp">Slide In Up</option>\n          <option value="slideInDown">Slide In Down</option>\n          <option value="bounce">Bounce</option>\n          <option value="pulse">Pulse</option>\n          <option value="shake">Shake</option>\n          <option value="custom">Custom CSS</option>\n        </select>\n        <div class="nv-two-col" style="margin-top: 8px;">\n          <div>\n            <div class="nv-panel-label">Duration</div>\n            <input type="text" id="nv-animation-duration" class="nv-input" placeholder="0.5s" value="0.5s">\n          </div>\n          <div>\n            <div class="nv-panel-label">Repeat</div>\n            <select id="nv-animation-iteration" class="nv-input">\n              <option value="1">Once</option>\n              <option value="2">2 times</option>\n              <option value="3">3 times</option>\n              <option value="5">5 times</option>\n              <option value="infinite">âˆž Infinite</option>\n            </select>\n          </div>\n        </div>\n        <div class="nv-panel-label" style="margin-top: 8px;">Delay (before start)</div>\n        <input type="text" id="nv-animation-delay" class="nv-input" placeholder="0s" value="0s">\n        <div id="nv-animation-custom-container" style="display: none; margin-top: 8px;">\n          <div class="nv-panel-label">Custom CSS Animation</div>\n          <textarea id="nv-animation-custom" class="nv-input" rows="2" placeholder="transform: scale(1.1);" style="font-family: monospace;"></textarea>\n        </div>\n      </div>\n      \n      <button class="nv-btn nv-btn-primary" id="nv-add-mod" style="flex: 1;">Add Change</button>\n        <button class="nv-btn nv-btn-secondary" id="nv-cancel">Cancel</button>\n      </div>\n    </div>\n    \n    <div class="nv-panel-section" style="margin-top: 16px; padding-top: 12px; border-top: 1px solid #e5e7eb;">\n      <div class="nv-panel-label w-full flex justify-between items-center">\n        <span>Saved Changes (<span id="nv-mod-count">0</span>)</span>\n      </div>\n      <div id="nv-mod-list" class="nv-mod-list"></div>\n      <button class="nv-btn nv-btn-success" id="nv-save" style="width: 100%; margin-top: 12px; font-weight: 600;">\n        Save All Changes\n      </button>\n    </div>\n  `,u.appendChild(y),document.body.appendChild(u);const h=new Map,x={css:{label:m("css")+" Change Style (CSS)",hint:"Modify colors, fonts, spacing",universal:!0},text:{label:m("text")+" Change Text",hint:"Replace text content",universal:!0},hide:{label:m("hide")+" Hide Element",hint:"Hide from visitors (CSS)",universal:!0},remove:{label:m("remove")+" Remove Element",hint:"Delete from DOM",universal:!0},clone:{label:m("clone")+" Clone Element",hint:"Duplicate this element",universal:!0},insertHtml:{label:m("insert")+" Insert HTML",hint:"Add HTML before/after",universal:!0},replaceHtml:{label:m("replace")+" Replace HTML",hint:"Replace with custom HTML",universal:!0},resize:{label:m("resize")+" Resize Element",hint:"Change width/height",universal:!0},reorder:{label:m("reorder")+" Reorder Element",hint:"Move among siblings",universal:!0},move:{label:m("move")+" Move Element",hint:"Offset position",universal:!0},attribute:{label:m("attr")+" Modify Attribute",hint:"Change any attribute",universal:!0},class:{label:m("class")+" Toggle Classes",hint:"Add/remove CSS classes",universal:!0},tooltip:{label:m("tooltip")+" Add Tooltip",hint:"Show text on hover",universal:!0},sticky:{label:m("sticky")+" Make Sticky",hint:"Stick to viewport",universal:!0},animation:{label:m("anim")+" Add Animation",hint:"Animate on load",universal:!0},clickRedirect:{label:m("click")+" Click Redirect",hint:"Navigate on click",universal:!0},image:{label:m("image")+" Replace Image",hint:"Swap image source",tags:["IMG"]},link:{label:m("link")+" Replace Link",hint:"Change link URL",tags:["A"]},placeholder:{label:m("placeholder")+" Change Placeholder",hint:"Modify placeholder text",tags:["INPUT","TEXTAREA"]},formAction:{label:m("form")+" Change Form Action",hint:"Redirect form submission",tags:["FORM"]}};const f=["nv-css-panel","nv-text-panel","nv-hide-panel","nv-image-panel","nv-link-panel","nv-insertHtml-panel","nv-replaceHtml-panel","nv-resize-panel","nv-clone-panel","nv-reorder-panel","nv-move-panel","nv-attribute-panel","nv-class-panel","nv-clickRedirect-panel","nv-tooltip-panel","nv-sticky-panel","nv-placeholder-panel","nv-formAction-panel","nv-animation-panel"];function b(e){f.forEach(n=>{const t=document.getElementById(n);t&&(t.style.display=n===e?"block":"none")})}function k(e){try{let n;try{n=document.querySelectorAll(e.selector)}catch(t){if(!e.selector.includes(":"))throw t;{const t=e.selector.replace(/:/g,"\\:");n=document.querySelectorAll(t)}}n.forEach(n=>{const t=e.changes||{};switch(e.type){case"css":t.css&&Object.assign(n.style,t.css);break;case"text":void 0!==t.text&&(n.textContent=t.text);break;case"hide":n.style.display="none";break;case"remove":n.remove();break;case"clone":const e=t.cloneCount||1,o=t.clonePosition||"after";for(let t=0;t<e;t++){const e=n.cloneNode(!0);e.removeAttribute("id"),"before"===o?n.parentNode.insertBefore(e,n):n.parentNode.insertBefore(e,n.nextSibling)}break;case"image":if(t.imageUrl){const e=e=>{console.log("[navlens-editor] Replacing image:",e.src,"->",t.imageUrl),e.removeAttribute("srcset"),e.removeAttribute("data-srcset"),e.src=t.imageUrl,e.style.cssText+=`\n                  content: url(${t.imageUrl}) !important;\n                  object-fit: cover !important;\n                `,e.dataset.nvModified="true"};if("IMG"===n.tagName)e(n);else{n.querySelectorAll("img").forEach(e)}}break;case"link":t.linkUrl&&"A"===n.tagName&&(n.href=t.linkUrl,t.linkTarget&&(n.target=t.linkTarget));break;case"insertHtml":if(t.html){const e=t.insertPosition||"after";n.insertAdjacentHTML("before"===e?"beforebegin":"after"===e?"afterend":"prepend"===e?"afterbegin":"beforeend",t.html)}break;case"replaceHtml":t.html&&(n.outerHTML=t.html);break;case"resize":t.width&&(n.style.width=t.width),t.height&&(n.style.height=t.height);break;case"reorder":const i=n.parentNode,a=Array.from(i.children),l=Math.min(t.newIndex||0,a.length-1);i.insertBefore(n,a[l]);break;case"move":t.position&&(n.style.transform=`translate(${t.position.x}px, ${t.position.y}px)`);break;case"attribute":t.attributes&&Object.entries(t.attributes).forEach(([e,t])=>n.setAttribute(e,t));break;case"class":t.addClass&&t.addClass.forEach(e=>n.classList.add(e)),t.removeClass&&t.removeClass.forEach(e=>n.classList.remove(e));break;case"clickRedirect":t.redirectUrl&&(n.style.cursor="pointer",n.addEventListener("click",e=>{e.preventDefault(),window.location.href=t.redirectUrl}));break;case"tooltip":t.tooltipText&&(n.title=t.tooltipText);break;case"sticky":n.style.position="sticky",n.style.top=t.stickyTop||"0px",n.style.zIndex=t.stickyZIndex||1e3;break;case"placeholder":void 0!==t.placeholderText&&(n.placeholder=t.placeholderText);break;case"formAction":t.formActionUrl&&"FORM"===n.tagName&&(n.action=t.formActionUrl);break;case"animation":if(t.animationName){const e=t.animationDuration||"0.5s";"custom"===t.animationName&&t.animationCustom?(n.style.transition=`all ${e}`,Object.assign(n.style,function(e){const n={};return e.split(";").forEach(e=>{const[t,o]=e.split(":").map(e=>e.trim());if(t&&o){const e=t.replace(/-([a-z])/g,e=>e[1].toUpperCase());n[e]=o}}),n}(t.animationCustom))):n.style.animation=`${t.animationName} ${e}`}}})}catch(n){console.warn("[navlens-editor] Could not apply modification:",e.selector,n)}}function w(e){if(e.id)return`#${CSS.escape(e.id)}`;if("IMG"===e.tagName){const n=e.getAttribute("src")||"";if(n.includes("/_next/image"))try{const e=new URL(n,window.location.origin).searchParams.get("url");if(e){const n=decodeURIComponent(e).split("/").pop();if(n&&n.length>3)return console.log("[navlens-editor] Using Next.js image filename:",n),`img[src*="${CSS.escape(n)}"]`}}catch(e){console.warn("[navlens-editor] Failed to parse Next.js image URL")}if(n){const e=n.split("/").pop()?.split("?")[0];if(e&&e.length>3&&"image"!==e)return`img[src*="${CSS.escape(e)}"]`}const t=e.getAttribute("alt");if(t)return`img[alt="${CSS.escape(t)}"]`}if("A"===e.tagName){const n=e.getAttribute("href");if(n&&"#"!==n&&"/"!==n){const e=`a[href="${CSS.escape(n)}"]`,t=document.querySelectorAll(e);if(1===t.length)return e;console.log(`[navlens-editor] Multiple links with href="${n}" (${t.length}), using path-based selector`)}}let n=[],t=e;for(;t&&t.nodeType===Node.ELEMENT_NODE&&t!==document.body;){let e=t.tagName.toLowerCase();if("A"===t.tagName&&t.getAttribute("href")){const n=t.getAttribute("href");n&&"#"!==n&&"/"!==n&&(e+=`[href="${CSS.escape(n)}"]`)}const o=t.parentElement;if(o){const n=Array.from(o.children).filter(e=>e.tagName===t.tagName);if(n.length>1){e+=`:nth-of-type(${n.indexOf(t)+1})`}}if(t.className&&"string"==typeof t.className){const n=t.className.trim().split(/\s+/).filter(e=>e&&!e.startsWith("nv-")&&!e.startsWith("__")).slice(0,1);n.length&&(e+="."+n.map(e=>CSS.escape(e)).join("."))}const i=t.getAttribute("data-testid"),a=t.getAttribute("role");if(i?e+=`[data-testid="${CSS.escape(i)}"]`:a&&["button","link","navigation","main","header","footer"].includes(a)&&(e+=`[role="${a}"]`),n.unshift(e),t.id||n.length>=4)break;t=t.parentElement}return n.join(" > ")}function E(e){return null!==e.closest("#navlens-editor")}function I(e){const n=e.getBoundingClientRect();g.style.display="block",g.style.top=n.top+window.scrollY+"px",g.style.left=n.left+window.scrollX+"px",g.style.width=n.width+"px",g.style.height=n.height+"px"}function C(){i=null,g.classList.remove("nv-selected"),g.style.display="none",document.getElementById("nv-edit-panel").style.display="none",document.getElementById("nv-instructions").style.display="block",document.getElementById("nv-font-size").value="",document.getElementById("nv-new-text").value="",document.getElementById("nv-image-url").value="",document.getElementById("nv-image-preview").innerHTML="",document.getElementById("nv-link-url").value="",document.getElementById("nv-insert-html").value="",document.getElementById("nv-replace-html").value="",document.getElementById("nv-resize-width").value="",document.getElementById("nv-resize-height").value="",document.getElementById("nv-clone-count").value="1",document.getElementById("nv-reorder-index").value="0",document.getElementById("nv-move-x").value="0",document.getElementById("nv-move-y").value="0",document.getElementById("nv-attr-name").value="",document.getElementById("nv-attr-value").value="",document.getElementById("nv-class-add").value="",document.getElementById("nv-class-remove").value="",document.getElementById("nv-redirect-url").value="",document.getElementById("nv-tooltip-text").value="",document.getElementById("nv-placeholder-text").value="",document.getElementById("nv-form-action-url").value="",document.getElementById("nv-animation-name").value="",document.getElementById("nv-animation-custom").value=""}function B(){const e=document.getElementById("nv-mod-list");document.getElementById("nv-mod-count").textContent=l.length;const n={css:m("css")+" CSS",text:m("text")+" Text",hide:m("hide")+" Hide",image:m("image")+" Image",link:m("link")+" Link",insertHtml:m("insert")+" HTML",replaceHtml:m("replace")+" HTML",resize:m("resize")+" Resize",clone:m("clone")+" Clone",reorder:m("reorder")+" Reorder",move:m("move")+" Move",attribute:m("attr")+" Attr",class:m("class")+" Class",clickRedirect:m("click")+" Click",tooltip:m("tooltip")+" Tooltip",sticky:m("sticky")+" Sticky",placeholder:m("placeholder")+" Placeholder",formAction:m("form")+" Action",animation:m("anim")+" Anim",remove:m("remove")+" Remove"};e.innerHTML=l.map((e,t)=>`\n      <div class="nv-mod-item">\n        <span>${n[e.type]||e.type}: ${e.selector.slice(0,25)}...</span>\n        <span class="nv-mod-delete" data-index="${t}">ðŸ—‘</span>\n      </div>\n    `).join(""),e.querySelectorAll(".nv-mod-delete").forEach(e=>{e.addEventListener("click",e=>{const n=parseInt(e.target.dataset.index),t=l[n];t&&function(e){const n=h.get(e.id);if(n)try{document.querySelectorAll(e.selector).forEach(t=>{switch(e.type){case"css":case"hide":case"resize":case"sticky":case"move":case"attribute":t.setAttribute("style",n.style);break;case"text":t.textContent=n.textContent;break;case"image":"IMG"===t.tagName&&(t.src=n.src);break;case"link":"A"===t.tagName&&(t.href=n.href);break;case"placeholder":t.placeholder=n.placeholder;break;case"formAction":"FORM"===t.tagName&&(t.action=n.action);break;case"class":t.className=n.className;break;case"tooltip":t.title=n.title;break;case"animation":t.style.animation="",t.style.transition=""}delete t.dataset.nvApplied}),h.delete(e.id)}catch(e){console.warn("[navlens-editor] Could not restore original state:",e)}}(t),l.splice(n,1),B()})})}document.getElementById("nv-mod-type").addEventListener("change",e=>{const n=e.target.value;b(`nv-${n}-panel`);const t=document.getElementById("nv-type-hint"),o=x[n];if(t.textContent=o?o.hint:"","class"===n&&i){const e=Array.from(i.classList).filter(e=>!e.startsWith("nv-"));document.getElementById("nv-current-classes").textContent=e.length?`Current: ${e.join(", ")}`:"No classes"}}),document.getElementById("nv-animation-name").addEventListener("change",e=>{document.getElementById("nv-animation-custom-container").style.display="custom"===e.target.value?"block":"none"}),document.getElementById("nv-image-file").addEventListener("change",async e=>{const i=e.target.files[0];if(!i)return;const l=document.getElementById("nv-image-preview");l.innerHTML='<div style="color: #9ca3af; font-size: 11px;">Uploading...</div>';try{const e=new FormData;e.append("file",i),e.append("siteId",s),e.append("experimentId",n||""),e.append("variantId",t||""),e.append("timestamp",o||""),e.append("signature",a||"");const d=await fetch(`${r}/api/experiments/upload`,{method:"POST",mode:"cors",body:e});if(!d.ok){const e=await d.json();throw new Error(e.error||"Upload failed")}const c=await d.json();document.getElementById("nv-image-url").value=c.url,l.innerHTML=`<img src="${c.url}" class="nv-preview-img" alt="Preview">`}catch(e){l.innerHTML=`<div style="color: #ef4444; font-size: 11px;">Error: ${e.message}</div>`}}),document.getElementById("nv-image-url").addEventListener("blur",e=>{const n=e.target.value.trim(),t=document.getElementById("nv-image-preview");n&&n.startsWith("http")?t.innerHTML=`<img src="${n}" class="nv-preview-img" alt="Preview" onerror="this.style.display='none'">`:t.innerHTML=""}),async function(){try{const e=new URLSearchParams({experimentId:n,siteId:s,variantId:t||"",ts:o||"",sig:a||""});console.log("[navlens-editor] Loading modifications from:",`${r}/api/experiments/modifications?${e}`);const i=await fetch(`${r}/api/experiments/modifications?${e}`);if(!i.ok){const e=await i.json().catch(()=>({}));return void console.error("[navlens-editor] Failed to load modifications:",i.status,e)}const d=await i.json();if(d.modifications&&d.modifications.length>0){const e=t?d.modifications.filter(e=>e.variant_id===t):d.modifications;l=e,B(),l.forEach(e=>{k(e)}),console.log(`[navlens-editor] Loaded ${l.length} existing modifications`)}}catch(e){console.error("[navlens-editor] Could not load existing modifications:",e)}}(),document.addEventListener("mousemove",e=>{"navigate"===window.navlensInteractionMode||d||E(e.target)?g.style.display="none":I(e.target)}),document.addEventListener("click",e=>{if(E(e.target))return;if("navigate"===window.navlensInteractionMode)return;e.preventDefault(),e.stopPropagation();let n=e.target;if("IMG"!==n.tagName&&"A"!==n.tagName&&"INPUT"!==n.tagName){const e=n.querySelectorAll("img");1===e.length&&(n=e[0],console.log("[navlens-editor] Auto-targeting nested img element"));const t=n.querySelectorAll("a");1===t.length&&"IMG"!==n.tagName&&(n=t[0],console.log("[navlens-editor] Auto-targeting nested link element"))}i=n,g.classList.add("nv-selected"),I(i),document.getElementById("nv-instructions").style.display="none",document.getElementById("nv-edit-panel").style.display="block",document.getElementById("nv-selected-tag").textContent=`<${i.tagName.toLowerCase()}>`,document.getElementById("nv-selected-selector").textContent=w(i);const t=window.getComputedStyle(i);document.getElementById("nv-bg-color-text").value=t.backgroundColor,document.getElementById("nv-text-color-text").value=t.color,function(e){const n=document.getElementById("nv-mod-type"),t=document.getElementById("nv-type-hint"),o=e.tagName.toUpperCase();n.innerHTML="";const i=document.createElement("optgroup");i.label="All Elements",Object.entries(x).forEach(([e,n])=>{if(n.universal){const t=document.createElement("option");t.value=e,t.textContent=n.label,i.appendChild(t)}}),n.appendChild(i);const a=[];if(("IMG"===o||e.querySelector("img"))&&a.push(["image",x.image]),("A"===o||e.querySelector("a"))&&a.push(["link",x.link]),("INPUT"===o||"TEXTAREA"===o||e.querySelector("input, textarea"))&&a.push(["placeholder",x.placeholder]),("FORM"===o||e.querySelector("form"))&&a.push(["formAction",x.formAction]),a.length>0){const e=document.createElement("optgroup"),t="IMG"===o?"IMG Specific":"A"===o?"Link Specific":"Contains Special Elements";e.label=t,a.forEach(([n,t])=>{const o=document.createElement("option");o.value=n,o.textContent=t.label,e.appendChild(o)}),n.appendChild(e),n.value=a[0][0]}const l=x[n.value];t.textContent=l?l.hint:"",b(`nv-${n.value}-panel`)}(i);const o=Array.from(i.classList).filter(e=>!e.startsWith("nv-"));document.getElementById("nv-current-classes").textContent=o.length?`Current: ${o.join(", ")}`:"No classes"},!0),["bg","text"].forEach(e=>{document.getElementById(`nv-${e}-color`).addEventListener("input",n=>{document.getElementById(`nv-${e}-color-text`).value=n.target.value}),document.getElementById(`nv-${e}-color-text`).addEventListener("input",n=>{document.getElementById(`nv-${e}-color`).value=n.target.value})}),document.getElementById("nv-add-mod").addEventListener("click",()=>{if(!i)return;const e=document.getElementById("nv-mod-type").value,n=w(i),o={id:"mod_"+Date.now(),variant_id:t||"variant_0",selector:n,type:e,changes:{}};switch(e){case"css":o.changes.css={};const e=document.getElementById("nv-bg-color-text").value,n=document.getElementById("nv-text-color-text").value,t=document.getElementById("nv-font-size").value;e&&(o.changes.css.backgroundColor=e),n&&(o.changes.css.color=n),t&&(o.changes.css.fontSize=t);break;case"text":o.changes.text=document.getElementById("nv-new-text").value;break;case"hide":case"remove":break;case"image":o.changes.imageUrl=document.getElementById("nv-image-url").value,console.log("[navlens-editor] Adding image modification:",{selector:o.selector,imageUrl:o.changes.imageUrl,selectedElement:i.tagName});break;case"link":o.changes.linkUrl=document.getElementById("nv-link-url").value,o.changes.linkTarget=document.getElementById("nv-link-target").value;break;case"insertHtml":o.changes.html=document.getElementById("nv-insert-html").value,o.changes.insertPosition=document.getElementById("nv-insert-position").value;break;case"replaceHtml":o.changes.html=document.getElementById("nv-replace-html").value;break;case"resize":o.changes.width=document.getElementById("nv-resize-width").value,o.changes.height=document.getElementById("nv-resize-height").value;break;case"clone":o.changes.cloneCount=parseInt(document.getElementById("nv-clone-count").value)||1,o.changes.clonePosition=document.getElementById("nv-clone-position").value||"after";break;case"reorder":o.changes.newIndex=parseInt(document.getElementById("nv-reorder-index").value)||0;break;case"move":o.changes.position={x:parseInt(document.getElementById("nv-move-x").value)||0,y:parseInt(document.getElementById("nv-move-y").value)||0};break;case"attribute":o.changes.attributes={};const a=document.getElementById("nv-attr-name").value.trim(),l=document.getElementById("nv-attr-value").value;a&&(o.changes.attributes[a]=l);break;case"class":const s=document.getElementById("nv-class-add").value.split(",").map(e=>e.trim()).filter(Boolean),r=document.getElementById("nv-class-remove").value.split(",").map(e=>e.trim()).filter(Boolean);s.length&&(o.changes.addClass=s),r.length&&(o.changes.removeClass=r);break;case"clickRedirect":o.changes.redirectUrl=document.getElementById("nv-redirect-url").value;break;case"tooltip":o.changes.tooltipText=document.getElementById("nv-tooltip-text").value,o.changes.tooltipPosition=document.getElementById("nv-tooltip-position").value;break;case"sticky":o.changes.stickyTop=document.getElementById("nv-sticky-top").value,o.changes.stickyZIndex=parseInt(document.getElementById("nv-sticky-zindex").value)||1e3;break;case"placeholder":o.changes.placeholderText=document.getElementById("nv-placeholder-text").value;break;case"formAction":o.changes.formActionUrl=document.getElementById("nv-form-action-url").value;break;case"animation":o.changes.animationName=document.getElementById("nv-animation-name").value,o.changes.animationDuration=document.getElementById("nv-animation-duration").value,o.changes.animationIteration=document.getElementById("nv-animation-iteration").value||"1",o.changes.animationDelay=document.getElementById("nv-animation-delay").value||"0s","custom"===o.changes.animationName&&(o.changes.animationCustom=document.getElementById("nv-animation-custom").value)}var a,s;a=i,s=o.id,h.has(s)||h.set(s,{outerHTML:a.outerHTML,style:a.getAttribute("style")||"",textContent:a.textContent,src:a.src,href:a.href,placeholder:a.placeholder,action:a.action,className:a.className,title:a.title}),k(o),l.push(o),B(),C()}),document.getElementById("nv-cancel").addEventListener("click",()=>{C()}),document.getElementById("nv-save").addEventListener("click",async()=>{if(!l.length)return void alert("No changes to save");const e=document.getElementById("nv-save");e.disabled=!0,e.textContent="â³ Saving...";try{const i=await fetch(`${r}/api/experiments/modifications`,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({experimentId:n,siteId:s,variantId:t,timestamp:o,signature:a,modifications:l})});if(i.ok)e.textContent="âœ… Saved!",setTimeout(()=>{e.textContent="ðŸ’¾ Save All Changes",e.disabled=!1},2e3);else{const n=await i.json();alert("Save failed: "+(n.error||"Unknown error")),e.textContent="ðŸ’¾ Save All Changes",e.disabled=!1}}catch(n){alert("Save failed: "+n.message),e.textContent="ðŸ’¾ Save All Changes",e.disabled=!1}}),document.getElementById("nv-close").addEventListener("click",()=>{if(l.length&&!confirm("You have unsaved changes. Close anyway?"))return;const e=new URL(window.location);e.searchParams.delete("__navlens_editor"),e.searchParams.delete("__variant"),e.searchParams.delete("__ts"),e.searchParams.delete("__sig"),window.location.href=e.toString()}),y.addEventListener("mousedown",()=>{d=!0}),document.addEventListener("mouseup",()=>{d=!1}),window.navlensInteractionMode="edit";let S=null,M=null;function N(e){["edit","drag","navigate"].forEach(n=>{const t=document.getElementById(`nv-mode-${n}`);t&&(n===e?(t.style.background="#3b82f6",t.style.color="white"):(t.style.background="transparent",t.style.color="#9ca3af"))}),g.style.display="none"}function L(){document.querySelectorAll('[draggable="true"]').forEach(e=>{E(e)||(e.removeAttribute("draggable"),e.style.cursor="")})}document.getElementById("nv-mode-edit").addEventListener("click",()=>{window.navlensInteractionMode="edit",N("edit"),L()}),document.getElementById("nv-mode-drag").addEventListener("click",()=>{window.navlensInteractionMode="drag",N("drag"),document.querySelectorAll("div, section, article, aside, header, footer, nav, main, p, h1, h2, h3, h4, h5, h6, ul, ol, li, a, button, img").forEach(e=>{E(e)||(e.setAttribute("draggable","true"),e.style.cursor="grab")}),console.log("[navlens-editor] Drag mode enabled")}),document.getElementById("nv-mode-navigate").addEventListener("click",()=>{window.navlensInteractionMode="navigate",N("navigate"),L()}),document.addEventListener("dragstart",e=>{"drag"!==window.navlensInteractionMode||E(e.target)||(S=e.target,M=w(S),e.target.style.opacity="0.5",e.dataTransfer.effectAllowed="move",console.log("[navlens-editor] Dragging:",M))}),document.addEventListener("dragend",e=>{"drag"===window.navlensInteractionMode&&(e.target.style.opacity="",S=null,document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove()))}),document.addEventListener("dragover",e=>{if("drag"!==window.navlensInteractionMode||!S)return;e.preventDefault(),e.dataTransfer.dropEffect="move";const n=e.target;if(n===S||E(n)||["HTML","HEAD","SCRIPT","STYLE","LINK","META","NOSCRIPT","IFRAME"].includes(n.tagName))return void document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove());document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove());const t=function(e,n){const t=e.parentNode,o=n.parentNode;if(t===o)return"sibling";const i=window.getComputedStyle(e),a="flex"===i.display||"grid"===i.display||"block"===i.display||"DIV"===e.tagName||"SECTION"===e.tagName||"MAIN"===e.tagName||"ARTICLE"===e.tagName||"UL"===e.tagName||"OL"===e.tagName,l=e.tagName===n.tagName||e.className&&n.className&&e.className.split(" ").some(e=>n.className.includes(e)),s=t&&o&&(t.tagName===o.tagName||t.className&&o.className&&t.className.split(" ").some(e=>o.className.includes(e))),r=window.getComputedStyle(n),d=["inline","inline-block"].includes(i.display),c=["block","flex","grid"].includes(r.display);if(d&&c)return"risky";if(a&&(l||s))return"container";if(l)return"similar";if(a)return"generic";return"generic"}(n,S),o={container:"#22c55e",sibling:"#3b82f6",similar:"#3b82f6",generic:"#eab308",risky:"#ef4444"},i=n.getBoundingClientRect(),a=i.top+i.height/2,l=e.clientY<a?"before":"after",s=document.createElement("div");s.className="nv-drop-indicator",s.style.cssText=`\n      position: absolute;\n      left: ${i.left}px;\n      width: ${i.width}px;\n      height: 4px;\n      background: ${o[t]||o.generic};\n      z-index: 10000;\n      pointer-events: none;\n      top: ${"before"===l?i.top+window.scrollY:i.bottom+window.scrollY}px;\n      box-shadow: 0 0 6px ${o[t]||o.generic};\n    `,document.body.appendChild(s),n.dataset.nvDropPosition=l,n.dataset.nvDropType=t}),document.addEventListener("drop",e=>{if("drag"!==window.navlensInteractionMode||!S)return;e.preventDefault();const n=e.target;if(n===S||E(n))return;const o=n.dataset.nvDropPosition||"after",i=n.dataset.nvDropType||"generic";delete n.dataset.nvDropPosition,delete n.dataset.nvDropType,document.querySelectorAll(".nv-drop-indicator").forEach(e=>e.remove()),console.log(`[navlens-editor] Dropping with zone type: ${i}`);const a=n.parentNode;"before"===o?a.insertBefore(S,n):a.insertBefore(S,n.nextSibling),z();const s={id:"mod_"+Date.now(),variant_id:t||"variant_0",selector:M,type:"dragMove",changes:{targetSelector:w(n),position:o}};l.push(s),B(),console.log("[navlens-editor] Moved element:",M,o,"target")});const A=[],T=[];function z(){A.push(JSON.parse(JSON.stringify(l))),T.length=0,R()}function R(){document.getElementById("nv-undo").disabled=0===A.length,document.getElementById("nv-redo").disabled=0===T.length}function $(){if(0===A.length)return;T.push(JSON.parse(JSON.stringify(l)));const e=A.pop();sessionStorage.setItem("nv-pending-mods",JSON.stringify(e)),sessionStorage.setItem("nv-redo-stack",JSON.stringify(T)),sessionStorage.setItem("nv-undo-stack",JSON.stringify(A)),location.reload()}function P(){if(0===T.length)return;A.push(JSON.parse(JSON.stringify(l)));const e=T.pop();sessionStorage.setItem("nv-pending-mods",JSON.stringify(e)),sessionStorage.setItem("nv-redo-stack",JSON.stringify(T)),sessionStorage.setItem("nv-undo-stack",JSON.stringify(A)),location.reload()}const j=sessionStorage.getItem("nv-pending-mods");if(j)try{const e=JSON.parse(j);l.length=0,e.forEach(e=>l.push(e)),B(),l.forEach(k);const n=sessionStorage.getItem("nv-undo-stack"),t=sessionStorage.getItem("nv-redo-stack");n&&A.push(...JSON.parse(n)),t&&T.push(...JSON.parse(t)),R(),sessionStorage.removeItem("nv-pending-mods"),sessionStorage.removeItem("nv-undo-stack"),sessionStorage.removeItem("nv-redo-stack"),console.log("[navlens-editor] Restored state after undo/redo")}catch(e){console.warn("[navlens-editor] Failed to restore pending mods:",e)}document.getElementById("nv-undo").addEventListener("click",$),document.getElementById("nv-redo").addEventListener("click",P),document.addEventListener("keydown",e=>{e.ctrlKey&&"z"===e.key&&(e.shiftKey?(e.preventDefault(),P()):(e.preventDefault(),$()))}),document.getElementById("nv-add-mod").addEventListener("click",()=>{z()},!0);const H=document.createElement("button");H.id="nv-floating-btn",H.innerHTML="ðŸ§ª",H.title="Open Navlens Editor",H.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: #3b82f6;\n    color: white;\n    border: none;\n    font-size: 24px;\n    cursor: pointer;\n    z-index: 10002;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    display: none;\n  ",u.appendChild(H),document.getElementById("nv-minimize").addEventListener("click",()=>{y.style.display="none",H.style.display="block"}),H.addEventListener("click",()=>{y.style.display="block",H.style.display="none"}),console.log("[navlens-editor] Visual editor loaded with 23 modification types + UX controls")})}();